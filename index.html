<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>2025 Seoul Travel Guide</title>
  
  <!-- PWA è¨­å®š -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Seoul2025">
  <meta name="application-name" content="Seoul2025">
  <meta name="theme-color" content="#fdf8f9">
  <meta name="mobile-web-app-capable" content="yes">

  <!-- App Icon è¨­å®š (SVG Data URI) -->
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='512' height='512' viewBox='0 0 512 512'%3E%3Cdefs%3E%3ClinearGradient id='grad' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%23fb7185;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%23e11d48;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='512' height='512' rx='120' fill='url(%23grad)'/%3E%3Ctext x='50%25' y='42%25' dominant-baseline='middle' text-anchor='middle' font-family='sans-serif' font-weight='900' font-size='110' fill='white' style='text-shadow: 4px 4px 8px rgba(0,0,0,0.15)'%3ESEOUL%3C/text%3E%3Ctext x='50%25' y='65%25' dominant-baseline='middle' text-anchor='middle' font-family='sans-serif' font-weight='bold' font-size='90' fill='white' style='text-shadow: 3px 3px 6px rgba(0,0,0,0.15)'%3E2025%3C/text%3E%3Cpath d='M256 360 Q286 390 316 360 T376 360 Q406 390 376 420 T316 420 Q286 450 256 420 Q226 450 196 420 T136 420 Q106 390 136 360 T196 360 Q226 330 256 360' fill='none' stroke='white' stroke-width='8' stroke-linecap='round' opacity='0.3'/%3E%3C/svg%3E">
  
  <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='512' height='512' viewBox='0 0 512 512'%3E%3Cdefs%3E%3ClinearGradient id='grad' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%23fb7185;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%23e11d48;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='512' height='512' rx='120' fill='url(%23grad)'/%3E%3Ctext x='50%25' y='42%25' dominant-baseline='middle' text-anchor='middle' font-family='sans-serif' font-weight='900' font-size='110' fill='white' style='text-shadow: 4px 4px 8px rgba(0,0,0,0.15)'%3ESEOUL%3C/text%3E%3Ctext x='50%25' y='65%25' dominant-baseline='middle' text-anchor='middle' font-family='sans-serif' font-weight='bold' font-size='90' fill='white' style='text-shadow: 3px 3px 6px rgba(0,0,0,0.15)'%3E2025%3C/text%3E%3Cpath d='M256 360 Q286 390 316 360 T376 360 Q406 390 376 420 T316 420 Q286 450 256 420 Q226 450 196 420 T136 420 Q106 390 136 360 T196 360 Q226 330 256 360' fill='none' stroke='white' stroke-width='8' stroke-linecap='round' opacity='0.3'/%3E%3C/svg%3E">
  
  <link rel="manifest" href='data:application/manifest+json,{"name":"Seoul2025","short_name":"Seoul2025","start_url":".","display":"standalone","background_color":"#fdf8f9","theme_color":"#fdf8f9","icons":[{"src":"data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%27512%27 height=%27512%27 viewBox=%270 0 512 512%27%3E%3Cdefs%3E%3ClinearGradient id=%27grad%27 x1=%270%25%27 y1=%270%25%27 x2=%27100%25%27 y2=%27100%25%27%3E%3Cstop offset=%270%25%27 style=%27stop-color:%23fb7185;stop-opacity:1%27 /%3E%3Cstop offset=%27100%25%27 style=%27stop-color:%23e11d48;stop-opacity:1%27 /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width=%27512%27 height=%27512%27 rx=%27120%27 fill=%27url(%23grad)%27/%3E%3Ctext x=%2750%25%27 y=%2742%25%27 dominant-baseline=%27middle%27 text-anchor=%27middle%27 font-family=%27sans-serif%27 font-weight=%27900%27 font-size=%27110%27 fill=%27white%27 style=%27text-shadow: 4px 4px 8px rgba(0,0,0,0.15)%27%3ESEOUL%3C/text%3E%3Ctext x=%2750%25%27 y=%2765%25%27 dominant-baseline=%27middle%27 text-anchor=%27middle%27 font-family=%27sans-serif%27 font-weight=%27bold%27 font-size=%2790%27 fill=%27white%27 style=%27text-shadow: 3px 3px 6px rgba(0,0,0,0.15)%27%3E2025%3C/text%3E%3Cpath d=%27M256 360 Q286 390 316 360 T376 360 Q406 390 376 420 T316 420 Q286 450 256 420 Q226 450 196 420 T136 420 Q106 390 136 360 T196 360 Q226 330 256 360%27 fill=%27none%27 stroke=%27white%27 stroke-width=%278%27 stroke-linecap=%27round%27 opacity=%270.3%27/%3E%3C/svg%3E","sizes":"192x192","type":"image/svg+xml","purpose":"any maskable"},{"src":"data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%27512%27 height=%27512%27 viewBox=%270 0 512 512%27%3E%3Cdefs%3E%3ClinearGradient id=%27grad%27 x1=%270%25%27 y1=%270%25%27 x2=%27100%25%27 y2=%27100%25%27%3E%3Cstop offset=%270%25%27 style=%27stop-color:%23fb7185;stop-opacity:1%27 /%3E%3Cstop offset=%27100%25%27 style=%27stop-color:%23e11d48;stop-opacity:1%27 /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width=%27512%27 height=%27512%27 rx=%27120%27 fill=%27url(%23grad)%27/%3E%3Ctext x=%2750%25%27 y=%2742%25%27 dominant-baseline=%27middle%27 text-anchor=%27middle%27 font-family=%27sans-serif%27 font-weight=%27900%27 font-size=%27110%27 fill=%27white%27 style=%27text-shadow: 4px 4px 8px rgba(0,0,0,0.15)%27%3ESEOUL%3C/text%3E%3Ctext x=%2750%25%27 y=%2765%25%27 dominant-baseline=%27middle%27 text-anchor=%27middle%27 font-family=%27sans-serif%27 font-weight=%27bold%27 font-size=%2790%27 fill=%27white%27 style=%27text-shadow: 3px 3px 6px rgba(0,0,0,0.15)%27%3E2025%3C/text%3E%3Cpath d=%27M256 360 Q286 390 316 360 T376 360 Q406 390 376 420 T316 420 Q286 450 256 420 Q226 450 196 420 T136 420 Q106 390 136 360 T196 360 Q226 330 256 360%27 fill=%27none%27 stroke=%27white%27 stroke-width=%278%27 stroke-linecap=%27round%27 opacity=%270.3%27/%3E%3C/svg%3E","sizes":"512x512","type":"image/svg+xml","purpose":"any maskable"}]}'>

  <!-- è¼‰å…¥ Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- è¼‰å…¥ Babel -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    body { font-family: sans-serif; background-color: #fdf8f9; user-select: none; -webkit-user-select: none; }
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    @keyframes fade-in {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .animate-fade-in { animation: fade-in 0.3s ease-out forwards; }
    
    /* Mic pulse animation */
    @keyframes pulse-mic {
      0% { box-shadow: 0 0 0 0 rgba(251, 113, 133, 0.7); }
      70% { box-shadow: 0 0 0 10px rgba(251, 113, 133, 0); }
      100% { box-shadow: 0 0 0 0 rgba(251, 113, 133, 0); }
    }
    .animate-pulse-mic { animation: pulse-mic 1.5s infinite; }
  </style>
</head>
<body>
  <div id="root"></div>

  <!-- React ç¨‹å¼ç¢¼ -->
  <script type="text/babel" data-type="module">
    import React, { useState, useEffect, useRef, useMemo } from 'https://esm.sh/react@18.2.0';
    import { createRoot } from 'https://esm.sh/react-dom@18.2.0/client';
    import { 
      Plane, Train, Bus, MapPin, Music, Coffee, Camera, Moon, Sun, Cloud, 
      Snowflake, Clock, Edit3, Globe, ChevronRight, Navigation, Footprints, 
      Utensils, ShoppingBag, BedDouble, Ticket, Home, Ship, Car, Sparkles, 
      MessageCircle, X, Send, Loader2, Languages, Bot, AlertTriangle, Volume2,
      ClipboardCheck, FileText, AlertCircle, Briefcase, Scan, CloudRain, Mic, Wand2, Plus, Save, Check, Trash2, Banknote, Search, XCircle, LayoutGrid, List, Image as ImageIcon, ArrowRight, CornerDownLeft
    } from 'https://esm.sh/lucide-react@0.263.1';

    // --- è¨­å®š ---
    const LANGUAGES = { ZH: 'ZH', KR: 'KR', EN: 'EN', JP: 'JP' };
    const UI_LABELS = {
      ZH: { title: '2025 é¦–çˆ¾ä¹‹æ—…', subtitle: 'åœ­è³¢æ¼”å”±æœƒãƒ»å†¬æ—¥é¦–çˆ¾', editTip: 'é»žæ“Šæ–‡å­—å³å¯ç·¨è¼¯', days: ['æº–å‚™', 'Day 1', 'Day 2', 'Day 3', 'Day 4', 'Day 5', 'Day 6', 'Day 7'], transport: 'äº¤é€š', estTime: 'æ™‚é–“', location: 'åœ°é»ž', aiChat: 'AI éš¨èº«å°ŽéŠ', genPhrases: 'éŸ“èªžå¹«æ‰‹', phrasesTitle: 'âœ¨ æƒ…å¢ƒéŸ“èªžå°å¹«æ‰‹', chatPlaceholder: 'å•å• AI...', close: 'é—œé–‰', fallbackMsg: 'AI é€£ç·šç•°å¸¸', addEvent: 'æ–°å¢žè¡Œç¨‹', addModalTitle: 'æ–°å¢žè¡Œç¨‹', addModalTime: 'æ™‚é–“ (24å°æ™‚åˆ¶)', addModalContent: 'åœ°é»ž / æ´»å‹•å…§å®¹', addModalSubmit: 'å„²å­˜ä¸¦æŽ’åº', addModalCancel: 'å–æ¶ˆ', addItem: 'æ–°å¢žé …ç›®', splitBill: 'åˆ†å¸³', total: 'ç¸½æ”¯å‡º', perPerson: 'æ¯äººæ‡‰ä»˜', rate: 'åŒ¯çŽ‡', addPhrase: 'æ–°å¢žè‡ªè¨‚çŸ­å¥', phraseMeaningPlaceholder: 'ä¸­æ–‡æ„æ€', shoppingList: 'æŽ¡è³¼æ¸…å–®', shoppingAdd: 'æ–°å¢žå•†å“', shoppingName: 'å•†å“åç¨±', shoppingCategory: 'é¡žåˆ¥ (å¦‚:ç¾Žå¦)', shoppingImage: 'åœ–ç‰‡ç¶²å€æˆ–ä¸Šå‚³', shoppingUpload: 'é¸æ“‡åœ–ç‰‡', shoppingViewList: 'æ¸…å–®æ¨¡å¼', shoppingViewGrid: 'åœ–ç‰‡æ¨¡å¼', shoppingTab: 'æŽ¡è³¼' },
      KR: { title: '2025 ì„œìš¸ ì—¬í–‰', subtitle: 'ê·œí˜„ ì½˜ì„œíŠ¸ â€¢ ê²¨ìš¸ ì„œìš¸', editTip: 'í´ë¦­í•˜ì—¬ íŽ¸ì§‘', days: ['ì¤€ë¹„', '1ì¼ì°¨', '2ì¼ì°¨', '3ì¼ì°¨', '4ì¼ì°¨', '5ì¼ì°¨', '6ì¼ì°¨', '7ì¼ì°¨'], transport: 'êµí†µ', estTime: 'ì‹œê°„', location: 'ìž¥ì†Œ', aiChat: 'AI ê°€ì´ë“œ', genPhrases: 'í•œêµ­ì–´ ë„ìš°ë¯¸', phrasesTitle: 'âœ¨ í•œêµ­ì–´', chatPlaceholder: 'ì§ˆë¬¸...', close: 'ë‹«ê¸°', fallbackMsg: 'AI ì˜¤ë¥˜', addEvent: 'ì¼ì • ì¶”ê°€', addModalTitle: 'ì¶”ê°€', addModalTime: 'ì‹œê°„', addModalContent: 'ë‚´ìš©', addModalSubmit: 'ì €ìž¥', addModalCancel: 'ì·¨ì†Œ', addItem: 'í•­ëª© ì¶”ê°€', splitBill: 'ì •ì‚°', total: 'ì´ ì§€ì¶œ', perPerson: '1ì¸ë‹¹', rate: 'í™˜ìœ¨', addPhrase: 'ë¬¸êµ¬ ì¶”ê°€', phraseMeaningPlaceholder: 'ì˜ë¯¸', shoppingList: 'ì‡¼í•‘ ë¦¬ìŠ¤íŠ¸', shoppingAdd: 'ìƒí’ˆ ì¶”ê°€', shoppingName: 'ìƒí’ˆëª…', shoppingCategory: 'ì¹´í…Œê³ ë¦¬', shoppingImage: 'ì´ë¯¸ì§€', shoppingUpload: 'ì—…ë¡œë“œ', shoppingViewList: 'ë¦¬ìŠ¤íŠ¸', shoppingViewGrid: 'ê·¸ë¦¬ë“œ', shoppingTab: 'ì‡¼í•‘' },
      EN: { title: 'Seoul Trip 2025', subtitle: 'Kyuhyun Concert â€¢ Winter Seoul', editTip: 'Click to edit', days: ['Prep', 'Day 1', 'Day 2', 'Day 3', 'Day 4', 'Day 5', 'Day 6', 'Day 7'], transport: 'Transport', estTime: 'Time', location: 'Loc', aiChat: 'AI Guide', genPhrases: 'Helper', phrasesTitle: 'âœ¨ Phrases', chatPlaceholder: 'Ask AI...', close: 'Close', fallbackMsg: 'AI Offline', addEvent: 'Add', addModalTitle: 'Add Event', addModalTime: 'Time', addModalContent: 'Content', addModalSubmit: 'Save', addModalCancel: 'Cancel', addItem: 'Add Item', splitBill: 'Split Bill', total: 'Total', perPerson: 'Per Person', rate: 'Rate', addPhrase: 'Add Phrase', phraseMeaningPlaceholder: 'Meaning', shoppingList: 'Shopping List', shoppingAdd: 'Add Item', shoppingName: 'Item Name', shoppingCategory: 'Category', shoppingImage: 'Image', shoppingUpload: 'Upload', shoppingViewList: 'List', shoppingViewGrid: 'Grid', shoppingTab: 'Shop' },
      JP: { title: '2025 ã‚½ã‚¦ãƒ«æ—…è¡Œ', subtitle: 'ã‚­ãƒ¥ãƒ’ãƒ§ãƒ³ã‚³ãƒ³ã‚µãƒ¼ãƒˆãƒ»å†¬ã®ã‚½ã‚¦ãƒ«', editTip: 'ã‚¯ãƒªãƒƒã‚¯ã—ã¦ç·¨é›†', days: ['æº–å‚™', '1æ—¥ç›®', '2æ—¥ç›®', '3æ—¥ç›®', '4æ—¥ç›®', '5æ—¥ç›®', '6æ—¥ç›®', '7æ—¥ç›®'], transport: 'äº¤é€š', estTime: 'æ™‚é–“', location: 'å ´æ‰€', aiChat: 'AI ã‚¬ã‚¤ãƒ‰', genPhrases: 'éŸ“å›½èªžãƒ˜ãƒ«ãƒ—', phrasesTitle: 'âœ¨ éŸ“å›½èªž', chatPlaceholder: 'è³ªå•...', close: 'é–‰ã˜ã‚‹', fallbackMsg: 'AIã‚¨ãƒ©ãƒ¼', addEvent: 'è¿½åŠ ', addModalTitle: 'è¿½åŠ ', addModalTime: 'æ™‚é–“', addModalContent: 'å†…å®¹', addModalSubmit: 'ä¿å­˜', addModalCancel: 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«', addItem: 'è¿½åŠ ', splitBill: 'å‰²ã‚Šå‹˜', total: 'åˆè¨ˆ', perPerson: 'ä¸€äººå½“ãŸã‚Š', rate: 'ãƒ¬ãƒ¼ãƒˆ', addPhrase: 'ãƒ•ãƒ¬ãƒ¼ã‚ºè¿½åŠ ', phraseMeaningPlaceholder: 'æ„å‘³', shoppingList: 'è²·ã„ç‰©ãƒªã‚¹ãƒˆ', shoppingAdd: 'å•†å“è¿½åŠ ', shoppingName: 'å•†å“å', shoppingCategory: 'ã‚«ãƒ†ã‚´ãƒª', shoppingImage: 'ç”»åƒ', shoppingUpload: 'ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰', shoppingViewList: 'ãƒªã‚¹ãƒˆ', shoppingViewGrid: 'ã‚°ãƒªãƒƒãƒ‰', shoppingTab: 'è²·ã„ç‰©' }
    };

    const FALLBACK_PHRASES_BY_TYPE = {
      food: [
        { k: 'ë©”ë‰´íŒ ì¢€ ì£¼ì„¸ìš”', p: 'Menyupan jom juseyo', m: { ZH: 'è«‹çµ¦æˆ‘èœå–®', EN: 'Menu please', JP: 'ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ãã ã•ã„', KR: 'ë©”ë‰´íŒ ì¢€ ì£¼ì„¸ìš”' } },
        { k: 'ì´ê±° ì£¼ì„¸ìš”', p: 'Ige juseyo', m: { ZH: 'è«‹çµ¦æˆ‘é€™å€‹', EN: 'This one please', JP: 'ã“ã‚Œã‚’ãã ã•ã„', KR: 'ì´ê±° ì£¼ì„¸ìš”' } },
        { k: 'ê³„ì‚°í•´ ì£¼ì„¸ìš”', p: 'Gyesanhae juseyo', m: { ZH: 'è«‹çµå¸³', EN: 'Check please', JP: 'ãŠä¼šè¨ˆãŠé¡˜ã„ã—ã¾ã™', KR: 'ê³„ì‚°í•´ ì£¼ì„¸ìš”' } },
        { k: 'ë¬¼ ì¢€ ì£¼ì„¸ìš”', p: 'Mul jom juseyo', m: { ZH: 'è«‹çµ¦æˆ‘æ°´', EN: 'Water please', JP: 'ãŠæ°´ã‚’ãã ã•ã„', KR: 'ë¬¼ ì¢€ ì£¼ì„¸ìš”' } },
        { k: 'ëœ ë§µê²Œ í•´ì£¼ì„¸ìš”', p: 'Deol maepge haejuseyo', m: { ZH: 'è«‹åšä¸è¾£ä¸€é»ž', EN: 'Less spicy please', JP: 'è¾›ãã—ãªã„ã§ãã ã•ã„', KR: 'ëœ ë§µê²Œ í•´ì£¼ì„¸ìš”' } },
        { k: 'í™”ìž¥ì‹¤ ì–´ë””ì˜ˆìš”?', p: 'Hwajangsil eodiyeyo?', m: { ZH: 'æ´—æ‰‹é–“åœ¨å“ªè£¡?', EN: 'Where is the toilet?', JP: 'ãƒˆã‚¤ãƒ¬ã¯ã©ã“ã§ã™ã‹ï¼Ÿ', KR: 'í™”ìž¥ì‹¤ ì–´ë””ì˜ˆìš”?' } }
      ],
      shopping: [
        { k: 'ì´ê±° ì–¼ë§ˆì˜ˆìš”?', p: 'Ige eolmayeyo?', m: { ZH: 'é€™å€‹å¤šå°‘éŒ¢?', EN: 'How much is this?', JP: 'ã“ã‚Œã¯ã„ãã‚‰ã§ã™ã‹ï¼Ÿ', KR: 'ì´ê±° ì–¼ë§ˆì˜ˆìš”?' } },
        { k: 'ìž…ì–´ë´ë„ ë¼ìš”?', p: 'Ibeobwado dwaeyo?', m: { ZH: 'å¯ä»¥è©¦ç©¿å—Ž?', EN: 'Can I try this on?', JP: 'è©¦ç€ã—ã¦ã‚‚ã„ã„ã§ã™ã‹ï¼Ÿ', KR: 'ìž…ì–´ë´ã‚‚ã„ã„ã§ã™ã‹ï¼Ÿ' } },
        { k: 'ìƒˆê²ƒ ìžˆì–´ìš”?', p: 'Saegeot isseoyo?', m: { ZH: 'æœ‰æ–°çš„å—Ž?', EN: 'Do you have a new one?', JP: 'æ–°ã—ã„ã®ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ', KR: 'ìƒˆê²ƒ ìžˆì–´ìš”?' } },
        { k: 'ê¹Žì•„ì£¼ì„¸ìš”', p: 'Kkakkajuseyo', m: { ZH: 'è«‹ç®—ä¾¿å®œä¸€é»ž', EN: 'Can you give a discount?', JP: 'å®‰ãã—ã¦ãã‚Œã¾ã›ã‚“ã‹ï¼Ÿ', KR: 'ê¹Žì•„ì£¼ì„¸ìš”' } },
        { k: 'í…ìŠ¤ ë¦¬íŽ€ ë˜ë‚˜ìš”?', p: 'Tekseu ripeon doenayo?', m: { ZH: 'å¯ä»¥é€€ç¨…å—Ž?', EN: 'Is tax refund available?', JP: 'å…ç¨Žã§ãã¾ã™ã‹ï¼Ÿ', KR: 'í…ìŠ¤ ë¦¬íŽ€ ë˜ë‚˜ìš”?' } },
        { k: 'ë´‰íˆ¬ ì£¼ì„¸ìš”', p: 'Bongtu juseyo', m: { ZH: 'è«‹çµ¦æˆ‘è¢‹å­', EN: 'Bag please', JP: 'è¢‹ã‚’ãã ã•ã„', KR: 'ë´‰íˆ¬ ì£¼ì„¸ìš”' } }
      ],
      transport: [
        { k: 'ì´ ë²„ìŠ¤ ëª…ë™ ê°€ë‚˜ìš”?', p: 'I beoseu Myeongdong ganayo?', m: { ZH: 'é€™ç­å…¬è»ŠåŽ»æ˜Žæ´žå—Ž?', EN: 'Does this bus go to Myeongdong?', JP: 'ã“ã®ãƒã‚¹ã¯æ˜Žæ´žã«è¡Œãã¾ã™ã‹ï¼Ÿ', KR: 'ì´ ë²„ìŠ¤ ëª…ë™ ê°€ë‚˜ìš”?' } },
        { k: 'ì—¬ê¸°ì„œ ë‚´ë ¤ì£¼ì„¸ìš”', p: 'Yeogiseo naeryeojuseyo', m: { ZH: 'è«‹åœ¨é€™è£¡è®“æˆ‘ä¸‹è»Š', EN: 'Please drop me off here', JP: 'ã“ã“ã§é™ã‚ã—ã¦ãã ã•ã„', KR: 'ì—¬ê¸°ì„œ ë‚´ë ¤ì£¼ì„¸ìš”' } },
        { k: 'ì–¼ë§ˆë‚˜ ê±¸ë ¤ìš”?', p: 'Eolmana geollyeoyo?', m: { ZH: 'è«‹å•è¦å¤šä¹…?', EN: 'How long does it take?', JP: 'ã©ã®ãã‚‰ã„ã‹ã‹ã‚Šã¾ã™ã‹ï¼Ÿ', KR: 'ì–¼ë§ˆë‚˜ ê±¸ë ¤ìš”?' } },
        { k: 'í‹°ë¨¸ë‹ˆ ì¶©ì „í•´ ì£¼ì„¸ìš”', p: 'T-money chungjeonhae juseyo', m: { ZH: 'è«‹å¹«æˆ‘å……å€¼ T-Money', EN: 'Please recharge T-money', JP: 'T-moneyã‚’ãƒãƒ£ãƒ¼ã‚¸ã—ã¦ãã ã•ã„', KR: 'í‹°ë¨¸ë‹ˆ ì¶©ì „í•´ ì£¼ì„¸ìš”' } },
        { k: 'ì§€í•˜ì² ì—­ì´ ì–´ë””ì˜ˆìš”?', p: 'Jihacheolyeogi eodiyeyo?', m: { ZH: 'åœ°éµç«™åœ¨å“ªè£¡?', EN: 'Where is the subway station?', JP: 'åœ°ä¸‹é‰„ã®é§…ã¯ã©ã“ã§ã™ã‹ï¼Ÿ', KR: 'ì§€í•˜ì² ì—­ì´ ì–´ë””ì˜ˆìš”?' } },
        { k: 'íƒì‹œ ì¢€ ë¶ˆëŸ¬ì£¼ì„¸ìš”', p: 'Taeksi jom bulleojuseyo', m: { ZH: 'è«‹å¹«æˆ‘å«è¨ˆç¨‹è»Š', EN: 'Please call a taxi for me', JP: 'ã‚¿ã‚¯ã‚·ãƒ¼ã‚’å‘¼ã‚“ã§ãã ã•ã„', KR: 'íƒì‹œ ì¢€ ë¶ˆëŸ¬ì£¼ì„¸ìš”' } }
      ],
      coffee: [
        { k: 'ì•„ì´ìŠ¤ ì•„ë©”ë¦¬ì¹´ë…¸ í•œ ìž” ì£¼ì„¸ìš”', p: 'Aiceu Americano hanjan juseyo', m: { ZH: 'è«‹çµ¦æˆ‘ä¸€æ¯å†°ç¾Žå¼', EN: 'One Iced Americano please', JP: 'ã‚¢ã‚¤ã‚¹ã‚¢ãƒ¡ãƒªã‚«ãƒ¼ãƒŽã‚’ãã ã•ã„', KR: 'ì•„ì´ìŠ¤ ì•„ë©”ë¦¬ì¹´ë…¸ í•œ ìž” ì£¼ì„¸ìš”' } },
        { k: 'ë”°ëœ»í•œ ë¼ë–¼ ì£¼ì„¸ìš”', p: 'Ttatteutan latte juseyo', m: { ZH: 'è«‹çµ¦æˆ‘ä¸€æ¯ç†±æ‹¿éµ', EN: 'One Hot Latte please', JP: 'ãƒ›ãƒƒãƒˆãƒ©ãƒ†ã‚’ãã ã•ã„', KR: 'ë”°ëœ»í•œ ë¼ë–¼ ì£¼ì„¸ìš”' } },
        { k: 'ì™€ì´íŒŒì´ ë¹„ë°€ë²ˆí˜¸ê°€ ë­ì˜ˆìš”?', p: 'WiFi bimilbeonhoga mwoyeyo?', m: { ZH: 'è«‹å• WiFi å¯†ç¢¼æ˜¯ä»€éº¼?', EN: 'What is the WiFi password?', JP: 'WiFiã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯ä½•ã§ã™ã‹ï¼Ÿ', KR: 'ì™€ì´íŒŒì´ ë¹„ë°€ë²ˆí˜¸ê°€ ë­ì˜ˆìš”?' } },
        { k: 'ì§„ë™ë²¨ ì£¼ì„¸ìš”', p: 'Jindongbel juseyo', m: { ZH: 'è«‹çµ¦æˆ‘éœ‡å‹•éˆ´', EN: 'Give me a buzzer please', JP: 'å‘¼ã³å‡ºã—ãƒ™ãƒ«ã‚’ãã ã•ã„', KR: 'ì§„ë™ë²¨ ì£¼ì„¸ìš”' } },
        { k: 'í…Œì´í¬ì•„ì›ƒ í• ê²Œìš”', p: 'Teikeuaut halgeyo', m: { ZH: 'æˆ‘è¦å¤–å¸¶', EN: 'To go please', JP: 'æŒã¡å¸°ã‚Šã¾ã™', KR: 'í…Œì´í¬ì•„ì›ƒ í• ê²Œìš”' } },
        { k: 'í™”ìž¥ì‹¤ ë¹„ë°€ë²ˆí˜¸ ì•Œë ¤ì£¼ì„¸ìš”', p: 'Hwajangsil bimilbeonho allyeojuseyo', m: { ZH: 'è«‹å‘Šè¨´æˆ‘å»æ‰€å¯†ç¢¼', EN: 'What is the toilet password?', JP: 'ãƒˆã‚¤ãƒ¬ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’æ•™ãˆã¦ãã ã•ã„', KR: 'í™”ìž¥ì‹¤ ë¹„ë°€ë²ˆí˜¸ ì•Œë ¤ì£¼ì„¸ìš”' } }
      ],
      default: [
        { k: 'ì•ˆë…•í•˜ì„¸ìš”', p: 'Annyeonghaseyo', m: { ZH: 'ä½ å¥½', EN: 'Hello', JP: 'ã“ã‚“ã«ã¡ã¯', KR: 'ì•ˆë…•í•˜ì„¸ìš”' } },
        { k: 'ê°ì‚¬í•©ë‹ˆë‹¤', p: 'Gamsahamnida', m: { ZH: 'è¬è¬', EN: 'Thank you', JP: 'ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™', KR: 'ê°ì‚¬í•©ë‹ˆë‹¤' } },
        { k: 'ì£„ì†¡í•©ë‹ˆë‹¤', p: 'Joesonghamnida', m: { ZH: 'å°ä¸èµ·', EN: 'I am sorry', JP: 'ã”ã‚ã‚“ãªã•ã„', KR: 'ì£„ì†¡í•©ë‹ˆë‹¤' } },
        { k: 'ìž ì‹œë§Œìš”', p: 'Jamsimanyo', m: { ZH: 'å€ŸéŽ / ç­‰ä¸€ä¸‹', EN: 'Excuse me / Just a moment', JP: 'ã™ã¿ã¾ã›ã‚“ / å°‘ã€…ãŠå¾…ã¡ãã ã•ã„', KR: 'ìž ì‹œë§Œìš”' } },
        { k: 'ë„ì™€ì£¼ì„¸ìš”', p: 'Dowajuseyo', m: { ZH: 'è«‹å¹«å¹«æˆ‘', EN: 'Please help me', JP: 'åŠ©ã‘ã¦ãã ã•ã„', KR: 'ë„ì™€ì£¼ì„¸ìš”' } },
        { k: 'ì˜ì–´ í•  ìˆ˜ ìžˆì–´ìš”?', p: 'Yeong-eo hal su isseoyo?', m: { ZH: 'ä½ æœƒèªªè‹±æ–‡å—Ž?', EN: 'Do you speak English?', JP: 'è‹±èªžã‚’è©±ã›ã¾ã™ã‹ï¼Ÿ', KR: 'ì˜ì–´ í•  ìˆ˜ ìžˆì–´ìš”?' } }
      ]
    };

    const PHRASE_DB = {
      food: FALLBACK_PHRASES_BY_TYPE.food,
      shopping: FALLBACK_PHRASES_BY_TYPE.shopping,
      transport: FALLBACK_PHRASES_BY_TYPE.transport,
      coffee: FALLBACK_PHRASES_BY_TYPE.coffee,
      default: FALLBACK_PHRASES_BY_TYPE.default
    };

    const getFallbackPhrases = (type, lang) => {
        const list = PHRASE_DB[type] || PHRASE_DB.default;
        return list.map(item => ({
            korean: item.k,
            pronunciation: item.p,
            meaning: item.m[lang] || item.m.EN || item.m.ZH 
        }));
    };

    // --- åœ°éµé¡è‰² ---
    const SUBWAY_COLORS = {
      '1': '#0052A4', '2': '#00A84D', '3': '#EF7C1C', '4': '#00A5DE',
      '5': '#996CAC', '6': '#CD7C2F', '7': '#747F00', '8': '#E6186C', '9': '#BDB092',
      'AREX': '#0090D2', 'A': '#0090D2', 'K': '#77C4A3', 'B': '#E7E727', 'S': '#A71E31'
    };

    // --- API ---
    const getApiKeyFromStorage = () => ""; 
    const callGeminiAPI = async () => ({ success: false, error: "API Disabled" });

    // --- Data Helper ---
    const toObj = (item) => (typeof item === 'string' ? { text: item, checked: false } : item);

    // --- Data ---
    const getInitialItinerary = (lang) => {
      const checklist = ['è­·ç…§ (æ•ˆæœŸ6å€‹æœˆä»¥ä¸Š) / Esimå¡', 'éŒ¢åŒ…æ•´ç† (ç¾é‡‘/ä¿¡ç”¨å¡/æ©Ÿç¥¨)', 'æ‰‹æ©Ÿå……é›»æ¿ / æ‰‹éŒ¶å……é›»ç·š / è½‰æŽ¥é ­(4.8mm)', 'è€³æ©Ÿ / è¡Œå‹•é›»æº (éœ€æ‰‹æ)', 'æ¢³æ´—åˆ·ç‰™ç”¨å“ / ä¿é¤ŠåŠå¸å¦ç”¨å“', 'è­·é«®æ•´é«®æ¢³å­ / çœ¼é¡', 'æ¯æ—¥è¡£æœ / å…§è¡£è¤² / è¥ªå­', 'ç¡è¡£è¤² / æ‹–éž‹ / è­·è†', 'ç†±æ°´ç“¶ / ä¿æš–è¡£ç‰©', 'ä¸€èˆ¬è—¥å“ / å£ç½©'].map(toObj);
      const sesItems = ['åœ°é»žï¼šT1 å…¥å¢ƒå¯©æŸ¥å¤§å»³ F å€', 'æ™‚é–“ï¼š07:00 - 18:00', 'æµç¨‹ï¼šä¸‹æ©Ÿ -> æ‰¾ F å€ç™»è¨˜ä¸­å¿ƒ -> æ‹ç…§/æŒ‡ç´‹ -> è‡ªå‹•é€šé—œ', 'å‚™æ¡ˆï¼šè‹¥éŒ¯éŽï¼Œå…¥å¢ƒå¾Œè‡³ 3 æ¨“å‡ºå¢ƒå¤§å»³ G å€è¾¦ç†'].map(toObj);
      
      const day0_ZH = {
        day: 0, date: 'å‡ºç™¼å‰', theme: 'è¡Œå‰æº–å‚™ & SeSç”³è«‹',
        activities: [
          { title: 'å¿…å‚™è¡ŒæŽæ¸…å–®', type: 'checklist', desc: 'å‡ºç™¼å‰è«‹å‹™å¿…ç¢ºèªä»¥ä¸‹ç‰©å“ï¼š', items: checklist },
          { title: 'ä»å·æ©Ÿå ´ SeS è‡ªå‹•é€šé—œç”³è«‹', type: 'ses', desc: 'å°ç£æ—…å®¢å¯æ–¼ T1 å…¥å¢ƒå¯©æŸ¥ F å€ç›´æŽ¥è¾¦ç†ã€‚', items: sesItems },
          { title: 'ä¸å¯æ‰‹æ / å¿…é ˆè¨—é‹', type: 'warning', desc: 'æ¶²é«” > 100ml, åˆ€å‰ªå·¥å…·ã€‚', items: ['å¤§ç“¶åŒ–å¦æ°´/ä¹³æ¶²', 'ä¿®çœ‰åˆ€/æŒ‡ç”²å‰ª', 'è…³æž¶/è‡ªæ‹æ£’ (ç®¡å¾‘>1cm, é•·>60cm)'].map(toObj) },
          { title: 'ä¸å¯è¨—é‹ / å¿…é ˆæ‰‹æ', type: 'warning_red', desc: 'é›»æ± é¡žå‹™å¿…éš¨èº«æ”œå¸¶ï¼', items: ['è¡Œå‹•é›»æº', 'é‹°é›»æ± ', 'ç­†é›»/å¹³æ¿', 'é›»å­è¸'].map(toObj) },
          { title: 'æ—…è¡Œæ–‡ä»¶', type: 'doc', desc: 'å»ºè­°å‚™ä»½ï¼š', items: ['Q-CODE', 'è¨‚æˆ¿ç¢ºèªå–®', 'æ¼”å”±æœƒé–€ç¥¨', 'ä¿éšªå–®'].map(toObj) }
        ]
      };
      const day0_KR = JSON.parse(JSON.stringify(day0_ZH));
      const day0_EN = JSON.parse(JSON.stringify(day0_ZH));
      const day0_JP = JSON.parse(JSON.stringify(day0_ZH));

      const days_ZH = [
          { day: 1, date: '12/18 (å››)', theme: 'æŠµé”é¦–çˆ¾ & é£¯åº—å…¥ä½', activities: [{ time: '12:00', title: 'å¾žæº«æš–çš„å®¶å‡ºç™¼', type: 'car', desc: 'é ç´„è‚¯é©›æ©Ÿå ´æŽ¥é€è‡³æ¡ƒåœ’æ©Ÿå ´ã€‚', location: 'Home', transport: 'å°ˆè»Š' }, { time: '15:15', title: 'é•·æ¦® BR160 èµ·é£›', type: 'flight', desc: 'æ¡ƒåœ’æ©Ÿå ´ (TPE) ç¬¬äºŒèˆªå»ˆ -> ä»å·æ©Ÿå ´ (ICN)', location: 'TPE Airport' }, { time: '18:45', title: 'æŠµé”ä»å·æ©Ÿå ´ & å…¥å¢ƒ', type: 'arrival', desc: 'å…¥å¢ƒã€é ˜è¡ŒæŽã€è²· T-Moneyã€‚', location: 'ICN Airport' }, { time: '20:00', title: 'å‰å¾€ Wecostay Namsan', type: 'bus', desc: 'ä»å·æ©Ÿå ´ 5B æˆ– 11B ç«™ç‰Œæ­ä¹˜ã€6015 æ©Ÿå ´å·´å£«ã€‘å¾€æ˜Žæ´žæ–¹å‘ã€‚æ–¼ã€Œå¿ æ­¦è·¯ç«™ (Chungmuro Station)ã€ä¸‹è»Šï¼Œæ­¥è¡Œç´„ 5 åˆ†é˜æŠµé”ã€‚', info: 'è²»ç”¨: 17,000 KRW / ç´„ 70-80 åˆ†é˜', customPhrases: [{ korean: 'G3 í˜¸í…”ì—ì„œ ë‚´ë ¤ì£¼ì„¸ìš”', pronunciation: 'G3 Hotel-eseo naeryeojuseyo', meaning: 'æˆ‘å€‘åˆ° G3 Hotel ä¸‹è»Šï¼Œè¬è¬' }], transport: 'ä»å·æ©Ÿå ´ 5B/11B ç«™ç‰Œæ­ä¹˜ã€6015 æ©Ÿå ´å·´å£«ã€‘(å¾€æ˜Žæ´žæ–¹å‘)ï¼Œç¶“éŽ 3 ç«™(ç´„70åˆ†é˜)ï¼Œæ–¼ã€Œå¿ æ­¦è·¯ç«™ã€ä¸‹è»Šï¼Œä¸‹è»Šå¾Œå¾€å›žèµ°ç´„ 2 åˆ†é˜å³é”ã€‚' }, { time: '21:30', title: 'é£¯åº— Check-in & æ™šé¤', type: 'food', desc: 'å…¥ä½å¾Œåƒç‚¸é›žæˆ–éƒ¨éšŠé‹ã€‚', location: 'Chungmuro' }] },
          { day: 2, date: '12/19 (äº”)', theme: 'æ­·å²æ¼«æ­¥ & å‚³çµ±éŸ»å‘³', activities: [{ time: '10:00', title: 'åŒ—æ‘å…«æ™¯ & åŒ—æ‘éŸ“å±‹æ‘', type: 'sight', desc: 'æ¼«æ­¥æ–¼å‚³çµ±éŸ“å±‹ç¾¤ï¼Œå°‹æ‰¾åŒ—æ‘å…«æ™¯ã€‚', location: 'Bukchon', transport: 'ðŸŸ 3è™Ÿç·š å®‰åœ‹ç«™ (2è™Ÿå‡ºå£)ï¼Œå‡ºç«™å¾Œæ²¿è‘—åŒ—æ‘è·¯æ­¥è¡Œå³é”ã€‚' }, { time: '12:30', title: 'åŒ—æ‘ç™¾å¹´åœŸç¨®è”˜é›žæ¹¯', type: 'food', desc: 'åŒ—æ‘é™„è¿‘çš„ç¾Žå‘³è”˜é›žæ¹¯ã€‚', location: 'Bukchon', transport: 'å¾’æ­¥ï¼šå¾žåŒ—æ‘éŸ“å±‹æ‘æ­¥è¡Œå‰å¾€ã€‚' }, { time: '14:30', title: 'æ™¯ç¦å®® & å…‰åŒ–é–€å»£å ´', type: 'sight', desc: 'åƒè§€å…‰åŒ–é–€èˆ‡æ™¯ç¦å®®ï¼Œæ¬£è³žå®ˆé–€å°‡æ›å´—å„€å¼ã€‚', location: 'Gyeongbokgung', transport: 'å¾’æ­¥ï¼šå¾žåŒ—æ‘å¾€è¥¿æ­¥è¡Œç´„ 15 åˆ†é˜å³å¯æŠµé”æ™¯ç¦å®®æ±å´ã€‚' }] },
          { day: 3, date: '12/20 (å…­)', theme: 'åŸŽéƒ­èˆ‡æ–‡åŒ–', activities: [{ time: '10:00', title: 'æ±å¤§é–€åŸŽéƒ­å…¬åœ’', type: 'sight', desc: 'æ•£æ­¥æ–¼é¦–çˆ¾åŸŽéƒ­ï¼Œæ¬£è³žåŸŽå¸‚æ™¯è‰²ã€‚', location: 'Dongdaemun', transport: 'ðŸŸ¦1è™Ÿç·š / ðŸ”µ4è™Ÿç·š æ±å¤§é–€ç«™ (1è™Ÿå‡ºå£)ï¼Œæ­¥è¡Œç´„ 5 åˆ†é˜ã€‚' }, { time: '12:30', title: 'ä»å¯ºæ´žé™„è¿‘é¤å»³', type: 'food', desc: 'åœ¨ä»å¯ºæ´žäº«ç”¨å‚³çµ±éŸ“å¼æ–™ç†ã€‚', location: 'Insadong', transport: 'åœ°éµï¼šå¾žæ±å¤§é–€æ­ä¹˜ðŸŸ¦1è™Ÿç·šè‡³é˜é–£ç«™ï¼Œæ­¥è¡Œè‡³ä»å¯ºæ´žã€‚' }, { time: '14:30', title: 'ä»å¯ºæ´žé€›è¡—', type: 'shopping', desc: 'åƒè§€äººäººå»£å ´ (Ssamzigil)ï¼Œè³¼è²·å‚³çµ±å·¥è—å“ã€‚', location: 'Insadong', transport: 'å¾’æ­¥ï¼šå°±åœ¨é¤å»³é™„è¿‘ã€‚' }, { time: '17:00', title: 'æ¸…æºªå·æ•£æ­¥', type: 'walk', desc: 'å‚æ™šæ™‚åˆ†æ²¿è‘—æ¸…æºªå·æ•£æ­¥ã€‚', location: 'Cheonggyecheon', transport: 'å¾’æ­¥ï¼šå¾žä»å¯ºæ´žå¾€å—æ­¥è¡Œç´„ 10 åˆ†é˜å³é”æ¸…æºªå·ã€‚' }, { time: '19:00', title: 'æ˜Žæ´žå•†åœˆ', type: 'shopping', desc: 'æ„Ÿå—æ˜Žæ´žçš„ç†±é¬§å¤œæ™¯ï¼Œäº«ç”¨è¡—é ­å°åƒæˆ–æŽ¡è³¼ç¾Žå¦ã€‚', location: 'Myeongdong', transport: 'å¾’æ­¥ï¼šæ²¿è‘—æ¸…æºªå·æ­¥è¡Œè‡³å»£æ©‹ï¼Œè½‰å¾€ä¹™æ”¯è·¯æ–¹å‘ç´„ 10 åˆ†é˜å³é”ã€‚' }] },
          { day: 4, date: '12/21 (æ—¥)', theme: 'åœ­è³¢æ¼”å”±æœƒ & éŸ“å±‹é¢¨æƒ…', activities: [{ time: '10:00', title: 'å—å±±è°·éŸ“å±‹æ‘', type: 'sight', desc: 'ä½æ–¼å¿ æ­¦è·¯ç«™æ—ï¼Œè¼•é¬†æ•£æ­¥é«”é©—å‚³çµ±åº­åœ’ï¼Œä¸éœ€é–€ç¥¨ã€‚', location: 'Chungmuro', transport: 'å¾’æ­¥ï¼šå¾ž Wecostay æ­¥è¡Œç´„ 5 åˆ†é˜ï¼Œç”±å¿ æ­¦è·¯ç«™ 3 æˆ– 4 è™Ÿå‡ºå£æ—å…¥å£é€²å…¥ã€‚' }, { time: '12:00', title: 'åˆé¤ & ä¼‘æ¯', type: 'food', desc: 'åœ¨å¿ æ­¦è·¯é™„è¿‘ç”¨é¤ï¼Œä¸¦å›žé£¯åº—ç¨ä½œæ•´ç†ï¼Œæº–å‚™å‰å¾€æ¼”å”±æœƒã€‚', location: 'Wecostay' }, { time: '14:30', title: 'å‰å¾€ Olympic Hall', type: 'train', desc: 'å‰å¾€å¥§æž—åŒ¹å…‹å…¬åœ’ã€‚', location: 'Olympic Park', transport: 'åœ°éµè½‰ä¹˜ï¼šðŸ”µ4è™Ÿç·š å¿ æ­¦è·¯ç«™ -> (å¾€ç•¶å¶ºæ–¹å‘ï¼Œ1ç«™) -> æ±å¤§é–€æ­·å²æ–‡åŒ–å…¬åœ’ç«™ï¼Œè½‰ä¹˜ðŸŸ£5è™Ÿç·š (å¾€é¦¬å·/æ²³å—é»”ä¸¹å±±æ–¹å‘ï¼Œç´„13ç«™) -> å¥§æž—åŒ¹å…‹å…¬åœ’ç«™ (3è™Ÿå‡ºå£)ã€‚' }, { time: '17:00', title: '2025 KYUHYUN Concert', type: 'music', desc: 'â€œThe Classicâ€ æ¼”å”±æœƒ @ Olympic Hallã€‚äº«å—åœ­è³¢çš„æ­Œè²ï¼', location: 'Olympic Park' }, { time: '20:30', title: 'è¿”å›žå¸‚å€ & æ™šé¤', type: 'food', desc: 'æ¼”å”±æœƒçµæŸå¾Œæ­åœ°éµè¿”å›žï¼Œåƒé “ç†±é¨°é¨°çš„çƒ¤è‚‰æ…¶åŠŸã€‚', location: 'Chungmuro', transport: 'åœ°éµè½‰ä¹˜ï¼šåŽŸè·¯è¿”å›žè‡³å¿ æ­¦è·¯ç«™ï¼Œç”± 1 è™Ÿå‡ºå£æ­¥è¡Œè‡³çƒ¤è‚‰åº—ã€‚' }] },
          { day: 5, date: '12/22 (ä¸€)', theme: 'ç¾ä»£é¦–çˆ¾ & æ¼¢æ±Ÿå¤œæ™¯', activities: [{ time: '11:00', title: 'The Hyundai Seoul', type: 'shopping', desc: 'åƒè§€é¦–çˆ¾æœ€å¤§çš„ç™¾è²¨å…¬å¸ã€‚', location: 'Yeouido', transport: 'åœ°éµè½‰ä¹˜ï¼šðŸ”µ4è™Ÿç·š å¿ æ­¦è·¯ç«™ -> (å¾€ç•¶å¶ºæ–¹å‘ï¼Œ1ç«™) -> æ±å¤§é–€æ­·å²æ–‡åŒ–å…¬åœ’ç«™ï¼Œè½‰ä¹˜ðŸŸ£5è™Ÿç·š (å¾€å‚èŠ±æ–¹å‘ï¼Œ9ç«™) -> æ±çŸ£å°¼é­¯ç«™ (1è™Ÿå‡ºå£)ï¼Œç›´é€šç™¾è²¨ã€‚' }, { time: '15:00', title: 'æ±çŸ£å³¶æ¼¢æ±Ÿå…¬åœ’', type: 'walk', desc: 'æ¼¢æ±Ÿé‚Šæ•£æ­¥ï¼Œç§Ÿå€Ÿé‡Žé¤å¢Š (è‹¥å¤©æ°£å…è¨±) æˆ–åœ¨æ¼¢æ±Ÿæ³¡éºµæ©Ÿç…®æ‹‰éºµã€‚', location: 'Yeouido', transport: 'å¾’æ­¥ï¼šå¾ž The Hyundai 1 è™Ÿé–€å‡ºä¾†ï¼ŒéŽé¦¬è·¯å³é”æ±çŸ£å³¶æ¼¢æ±Ÿå…¬åœ’ã€‚' }, { time: '17:00', title: 'æ¼¢æ±ŸéŠè¦½èˆ¹', type: 'ship', desc: 'Eland Cruise æ¬£è³žæ¼¢æ±Ÿå¤œæ™¯ã€‚', location: 'Yeouido Dock', transport: 'å¾’æ­¥ï¼šæ²¿è‘—æ¼¢æ±Ÿå…¬åœ’æ±Ÿé‚Šå¾€æ±èµ° (çœ‹åˆ° E-land æ¨™èªŒ)ï¼Œæ­¥è¡Œç´„ 10-15 åˆ†é˜è‡³ 2 è™Ÿç¢¼é ­ã€‚' }, { time: '19:30', title: 'å¼˜å¤§æ™šé¤', type: 'food', desc: 'å‰å¾€å……æ»¿å¹´è¼•æ´»åŠ›çš„å¼˜å¤§å•†åœˆäº«ç”¨æ™šé¤ã€‚', location: 'Hongdae', transport: 'åœ°éµè½‰ä¹˜ï¼šðŸŸ£5è™Ÿç·š æ±çŸ£å°¼é­¯ç«™ -> (å¾€å‚èŠ±æ–¹å‘ï¼Œ2ç«™) -> æ°¸ç™»æµ¦å€å»³ç«™ï¼Œè½‰ä¹˜ðŸŸ¢2è™Ÿç·š (å¾€åˆäº•/å¼˜å¤§æ–¹å‘ï¼Œ2ç«™) -> å¼˜å¤§å…¥å£ç«™ (9è™Ÿå‡ºå£)ã€‚' }] },
          { day: 6, date: '12/23 (äºŒ)', theme: 'ä¼´æ‰‹ç¦®æŽ¡è²· & æ‚ é–’æ™‚å…‰', activities: [{ time: '10:30', title: 'å»£è—å¸‚å ´', type: 'food', desc: 'å“åšç¶ è±†ç…Žé¤…ã€ç”Ÿç‰›è‚‰ã€éº»è—¥é£¯æ²ã€‚', location: 'Gwangjang Market', transport: 'åœ°éµè½‰ä¹˜ï¼šðŸ”µ4è™Ÿç·š å¿ æ­¦è·¯ç«™ -> (å¾€ç•¶å¶ºæ–¹å‘ï¼Œ2ç«™) -> æ±å¤§é–€ç«™ï¼Œè½‰ä¹˜ðŸŸ¦1è™Ÿç·š (å¾€é¦–çˆ¾ç«™æ–¹å‘ï¼Œ1ç«™) -> é˜è·¯5è¡—ç«™ (8è™Ÿå‡ºå£å³æ˜¯å¸‚å ´å…¥å£)ã€‚' }, { time: '14:00', title: 'æ¨‚å¤©è¶…å¸‚', type: 'shopping', desc: 'é¦–çˆ¾ç«™åº—ã€‚æŽ¡è³¼é›¶é£Ÿã€æ³¡éºµã€æµ·è‹”ç­‰ä¼´æ‰‹ç¦®ã€‚', location: 'Seoul Station', transport: 'åœ°éµç›´é”ï¼šç”±é˜è·¯5è¡—ç«™æ­ä¹˜ðŸŸ¦1è™Ÿç·š (å¾€é¦–çˆ¾ç«™/ä»å·æ–¹å‘ï¼Œ3ç«™) -> é¦–çˆ¾ç«™ (1è™Ÿå‡ºå£å‡ºä¾†ä¸Šæ‰‹æ‰¶æ¢¯å³é”)ã€‚' }, { time: '17:00', title: 'é£¯åº—æ‰“åŒ… & ä¼‘æ¯', type: 'hotel', desc: 'å°‡æˆ°åˆ©å“æ”¾å›žé£¯åº—ï¼Œæ•´ç†è¡ŒæŽã€‚', location: 'Wecostay', transport: 'åœ°éµç›´é”ï¼šç”±é¦–çˆ¾ç«™æ­ä¹˜ðŸ”µ4è™Ÿç·š (å¾€ç•¶å¶ºæ–¹å‘ï¼Œ2ç«™) -> å¿ æ­¦è·¯ç«™ã€‚' }, { time: '19:00', title: 'æœ€å¾Œçš„æ™šé¤', type: 'food', desc: 'åœ¨ä¹™æ”¯è·¯ (Hipjiro) é«”é©—ç¨ç‰¹çš„å··å¼„é…’å§æˆ–çƒ¤è…¸åº—ã€‚', location: 'Euljiro', transport: 'å¾’æ­¥ï¼šå¾žå¿ æ­¦è·¯ç«™ 8 è™Ÿå‡ºå£ï¼Œæ­¥è¡Œç´„ 5-8 åˆ†é˜è‡³ä¹™æ”¯è·¯ 3 è¡—ä¸€å¸¶å··å¼„ã€‚' }] },
          { day: 7, date: '12/24 (ä¸‰)', theme: 'å‘Šåˆ¥é¦–çˆ¾ & è¿”å®¶', activities: [{ time: '06:00', title: 'é€€æˆ¿ & å‰å¾€æ©Ÿå ´', type: 'bus', desc: 'æ­ä¹˜ 6015 æ©Ÿå ´å·´å£«å‰å¾€ä»å·æ©Ÿå ´ (æˆ–æ­è¨ˆç¨‹è»Šè‡³é¦–çˆ¾ç«™æ­ AREX ç›´é”è»Š)ã€‚', location: 'Airport Bus Stop', transport: 'æ©Ÿå ´å·´å£«ï¼šå‰å¾€å¿ æ­¦è·¯ç«™ 1 è™Ÿå‡ºå£å‰æ–¹å…¬è»Šç«™ï¼Œæ­ä¹˜ã€6015 æ©Ÿå ´å·´å£«ã€‘(å¾€ä»å·æ©Ÿå ´æ–¹å‘)ï¼Œè»Šç¨‹ç´„ 70-80 åˆ†é˜ã€‚' }, { time: '07:35', title: 'è¾¦ç†ç™»æ©Ÿ & é€€ç¨…', type: 'plane', desc: 'é•·æ¦®èˆªç©ºæ«ƒæª¯å ±åˆ°ï¼Œè¾¦ç†å¸‚å€é€€ç¨…å–®æ“šçš„æµ·é—œè“‹ç«  (è‹¥éœ€è¦)ã€‚', location: 'ICN Airport' }, { time: '11:40', title: 'BR169 èµ·é£›', type: 'flight', desc: 'ä»å· (ICN) -> æ¡ƒåœ’ (TPE)', location: 'Departure Hall' }, { time: '13:30', title: 'æŠµé”å°ç£', type: 'home', desc: 'å¹³å®‰æŠµé”æº«æš–çš„å®¶ã€‚', location: 'Taipei' }] }
      ];

      const days_KR = [
        { day: 1, date: '12/18 (ëª©)', theme: 'ì„œìš¸ ë„ì°© & í˜¸í…” ì²´í¬ì¸', activities: [{ time: '12:00', title: 'ì§‘ì—ì„œ ì¶œë°œ', type: 'car', desc: 'ì¼„ì´ ê³µí•­ í”½ì—… ì„œë¹„ìŠ¤ë¡œ íƒ€ì˜¤ìœ„ì•ˆ ê³µí•­ ì´ë™.', location: 'Home', transport: 'ì „ìš© ì°¨ëŸ‰' }, { time: '15:15', title: 'BR160 ì´ë¥™', type: 'flight', desc: 'íƒ€ì˜¤ìœ„ì•ˆ(TPE) 2í„°ë¯¸ë„ -> ì¸ì²œ(ICN)', location: 'TPE Airport' }, { time: '18:45', title: 'ì¸ì²œê³µí•­ ë„ì°© & ìž…êµ­', type: 'arrival', desc: 'ìž…êµ­ ìˆ˜ì†, ìˆ˜í•˜ë¬¼ ìˆ˜ë ¹, í‹°ë¨¸ë‹ˆ êµ¬ë§¤.', location: 'ICN Airport' }, { time: '20:00', title: 'Wecostay ì´ë™', type: 'bus', desc: '6015ë²ˆ ê³µí•­ë²„ìŠ¤ íƒ‘ìŠ¹ (ì¶©ë¬´ë¡œì—­ í•˜ì°¨).', info: 'ë¹„ìš©: 17,000 KRW', customPhrases: [{ korean: 'G3 í˜¸í…”ì—ì„œ ë‚´ë ¤ì£¼ì„¸ìš”', pronunciation: 'G3 Hotel-eseo naeryeojuseyo', meaning: 'G3 í˜¸í…”ì—ì„œ ë‚´ë ¤ì£¼ì„¸ìš”' }], transport: 'ì¸ì²œê³µí•­ 5B/11B ìŠ¹ê°•ìž¥ì—ì„œ ã€6015 ê³µí•­ë²„ìŠ¤ã€‘ íƒ‘ìŠ¹ (ëª…ë™ ë°©ë©´), 3ì •ê±°ìž¥(ì•½ 70ë¶„) í›„ ã€Œì¶©ë¬´ë¡œì—­ã€ í•˜ì°¨, ë„ë³´ 2ë¶„.' }, { time: '21:30', title: 'ì²´í¬ì¸ & ì €ë…', type: 'food', desc: 'ì²´í¬ì¸ í›„ ì¹˜í‚¨ì´ë‚˜ ë¶€ëŒ€ì°Œê°œ.', location: 'Chungmuro' }] },
        { day: 2, date: '12/19 (ê¸ˆ)', theme: 'ì—­ì‚¬ ì‚°ì±… & ì „í†µì˜ ë©‹', activities: [{ time: '10:00', title: 'ë¶ì´Œ í•œì˜¥ë§ˆì„ & 8ê²½', type: 'sight', desc: 'í•œì˜¥ë§ˆì„ ì‚°ì±… ë° ë¶ì´Œ 8ê²½ ê°ìƒ.', location: 'Bukchon', transport: '3í˜¸ì„  ì•ˆêµ­ì—­ 2ë²ˆ ì¶œêµ¬, ë„ë³´ ì´ë™.' }, { time: '12:30', title: 'ë¶ì´Œ ë°±ë…„í† ì¢…ì‚¼ê³„íƒ•', type: 'food', desc: 'ë¶ì´Œ ê·¼ì²˜ ë§›ìžˆëŠ” ì‚¼ê³„íƒ•.', location: 'Bukchon', transport: 'ë„ë³´: ë¶ì´Œ í•œì˜¥ë§ˆì„ì—ì„œ ë„ë³´ ì´ë™.' }, { time: '14:30', title: 'ê²½ë³µê¶ & ê´‘í™”ë¬¸', type: 'sight', desc: 'ê²½ë³µê¶ ê´€ëžŒ ë° ìˆ˜ë¬¸ìž¥ êµëŒ€ì‹.', location: 'Gyeongbokgung', transport: 'ë„ë³´: ë¶ì´Œì—ì„œ ì„œìª½ìœ¼ë¡œ ì•½ 15ë¶„ ì´ë™.' }] },
        { day: 3, date: '12/20 (í† )', theme: 'ì„±ê³½ê³¼ ë¬¸í™”', activities: [{ time: '10:00', title: 'ë™ëŒ€ë¬¸ ì„±ê³½ê³µì›', type: 'sight', desc: 'ì„œìš¸ ì„±ê³½ ì‚°ì±… ë° ë„ì‹œ ì „ë§.', location: 'Dongdaemun', transport: '1í˜¸ì„ /4í˜¸ì„  ë™ëŒ€ë¬¸ì—­ 1ë²ˆ ì¶œêµ¬.' }, { time: '12:30', title: 'ì¸ì‚¬ë™ ë§›ì§‘', type: 'food', desc: 'ì¸ì‚¬ë™ì—ì„œ ì „í†µ í•œì‹.', location: 'Insadong', transport: 'ì§€í•˜ì² : ë™ëŒ€ë¬¸ì—ì„œ 1í˜¸ì„  ì¢…ê°ì—­ ì´ë™ í›„ ë„ë³´.' }, { time: '14:30', title: 'ì¸ì‚¬ë™ ì‡¼í•‘', type: 'shopping', desc: 'ìŒˆì§€ê¸¸ ë° ê³µì˜ˆí’ˆ ì‡¼í•‘.', location: 'Insadong', transport: 'ë„ë³´: ì‹ë‹¹ ê·¼ì²˜.' }, { time: '17:00', title: 'ì²­ê³„ì²œ ì‚°ì±…', type: 'walk', desc: 'ì €ë… ë¬´ë µ ì²­ê³„ì²œ ì‚°ì±….', location: 'Cheonggyecheon', transport: 'ë„ë³´: ì¸ì‚¬ë™ì—ì„œ ë‚¨ìª½ìœ¼ë¡œ 10ë¶„.' }, { time: '19:00', title: 'ëª…ë™ ê±°ë¦¬', type: 'shopping', desc: 'ëª…ë™ ì‡¼í•‘ ë° ê¸¸ê±°ë¦¬ ìŒì‹ ì¦ê¸°ê¸°.', location: 'Myeongdong', transport: 'ë„ë³´: ì²­ê³„ì²œì—ì„œ ì„ì§€ë¡œ ë°©í–¥ìœ¼ë¡œ ì•½ 10-15ë¶„.' }] },
        { day: 4, date: '12/21 (ì¼)', theme: 'ì—¬ìœ ë¡œìš´ ì˜¤í›„ & ëª…ë™ ë§›ì§‘', activities: [{ time: '10:00', title: 'ë‚¨ì‚°ê³¨ í•œì˜¥ë§ˆì„', type: 'sight', desc: 'ìˆ™ì†Œ ê·¼ì²˜ ì‚°ì±….', location: 'Chungmuro', transport: 'ë„ë³´: ìˆ™ì†Œì—ì„œ 5ë¶„.' }, { time: '13:00', title: 'ì ì‹¬ & íœ´ì‹', type: 'food', desc: 'ì¶©ë¬´ë¡œ ê·¼ì²˜ ì‹ì‚¬ ë° íœ´ì‹.', location: 'Wecostay' }, { time: '15:00', title: 'ë‚¨ì‚° ì˜¤ë¥´ë¯¸ë¡œ ì´ë™', type: 'sight', desc: 'ëª…ë™ì—­ìœ¼ë¡œ ì´ë™í•˜ì—¬ ë‚¨ì‚° íˆ¬ëª… ì—˜ë¦¬ë² ì´í„° íƒ‘ìŠ¹.', location: 'Namsan Oreumi', transport: '4í˜¸ì„  ì¶©ë¬´ë¡œ -> ëª…ë™ì—­ 4ë²ˆ ì¶œêµ¬ -> ì§ì§„ -> íšŒí˜„ì‚¬ê±°ë¦¬ì—ì„œ ì¢ŒíšŒì „.', visual: 'namsan_path', link: { text: 'Namsan Oreumi', url: 'https://www.bring-you.info/zh-tw/n-seoul-tower' } }, { time: '15:40', title: 'ë‚¨ì‚° ì¼€ì´ë¸”ì¹´ & Nì„œìš¸íƒ€ì›Œ', type: 'sight', desc: 'ì¼€ì´ë¸”ì¹´ íƒ‘ìŠ¹í•˜ì—¬ ë‚¨ì‚°íƒ€ì›Œ ì´ë™. (ìš´í–‰ì‹œê°„: 10:00 - 23:00)', location: 'Namsan Tower', transport: 'ì˜¤ë¥´ë¯¸ ì—˜ë¦¬ë² ì´í„° -> ì¼€ì´ë¸”ì¹´ ë§¤í‘œì†Œ.' }, { time: '19:30', title: 'ëª…ë™ ì´ë™ & ì €ë…', type: 'food', desc: 'íƒ€ì›Œ ê´€ëžŒ í›„ ëª…ë™ìœ¼ë¡œ ì´ë™í•˜ì—¬ ì‡¼í•‘ ë° ì‹ì‚¬.', location: 'Myeongdong', transport: 'ì¼€ì´ë¸”ì¹´/ë²„ìŠ¤ í•˜ì‚° í›„ ë„ë³´ ì´ë™.' }] },
        { day: 5, date: '12/22 (ì›”)', theme: 'í˜„ëŒ€ ì„œìš¸ & í•œê°• ì•¼ê²½', activities: [{ time: '11:00', title: 'ë”í˜„ëŒ€ ì„œìš¸', type: 'shopping', desc: 'ì—¬ì˜ë„ ë°±í™”ì  êµ¬ê²½.', location: 'Yeouido', transport: 'ì§€í•˜ì² : 4í˜¸ì„  ì¶©ë¬´ë¡œ -> ë™ëŒ€ë¬¸ì—­ì‚¬ë¬¸í™”ê³µì›(5í˜¸ì„  í™˜ìŠ¹) -> ì—¬ì˜ë‚˜ë£¨ì—­(1ë²ˆ ì¶œêµ¬).' }, { time: '15:00', title: 'ì—¬ì˜ë„ í•œê°•ê³µì›', type: 'walk', desc: 'í•œê°• ì‚°ì±… ë° ë¼ë©´.', location: 'Yeouido', transport: 'ë„ë³´: ë”í˜„ëŒ€ 1ë²ˆ ê²Œì´íŠ¸ ê±´ë„ˆíŽ¸.' }, { time: '17:00', title: 'í•œê°• ìœ ëžŒì„ ', type: 'ship', desc: 'ì´ëžœë“œ í¬ë£¨ì¦ˆ ì•¼ê²½.', location: 'Yeouido Dock', transport: 'ë„ë³´: í•œê°•ê³µì› ë”°ë¼ ë™ìª½ìœ¼ë¡œ ì´ë™.' }, { time: '19:30', title: 'í™ëŒ€ ì €ë…', type: 'food', desc: 'ì ŠìŒì˜ ê±°ë¦¬ í™ëŒ€.', location: 'Hongdae', transport: 'ì§€í•˜ì² : 5í˜¸ì„  ì—¬ì˜ë‚˜ë£¨ -> ì˜ë“±í¬êµ¬ì²­(2í˜¸ì„  í™˜ìŠ¹) -> í™ëŒ€ìž…êµ¬ì—­.' }] },
        { day: 6, date: '12/23 (í™”)', theme: 'ê¸°ë…í’ˆ & ì—¬ìœ ', activities: [{ time: '10:30', title: 'ê´‘ìž¥ì‹œìž¥', type: 'food', desc: 'ë¹ˆëŒ€ë–¡, ìœ¡íšŒ, ë§ˆì•½ê¹€ë°¥.', location: 'Gwangjang Market', transport: 'ì§€í•˜ì² : 4í˜¸ì„  ì¶©ë¬´ë¡œ -> ë™ëŒ€ë¬¸(1í˜¸ì„  í™˜ìŠ¹) -> ì¢…ë¡œ5ê°€ì—­(8ë²ˆ ì¶œêµ¬).' }, { time: '14:00', title: 'ë¡¯ë°ë§ˆíŠ¸', type: 'shopping', desc: 'ì„œìš¸ì—­ì  ì‡¼í•‘.', location: 'Seoul Station', transport: 'ì§€í•˜ì² : 1í˜¸ì„  ì¢…ë¡œ5ê°€ -> ì„œìš¸ì—­.' }, { time: '17:00', title: 'ì§ ì •ë¦¬ & íœ´ì‹', type: 'hotel', desc: 'ì‡¼í•‘ ë¬¼í’ˆ ì •ë¦¬.', location: 'Wecostay', transport: 'ì§€í•˜ì² : 4í˜¸ì„  ì„œìš¸ì—­ -> ì¶©ë¬´ë¡œì—­.' }, { time: '19:00', title: 'ë§ˆì§€ë§‰ ì €ë…', type: 'food', desc: 'ì„ì§€ë¡œ íž™ì§€ë¡œ ê³¨ëª©.', location: 'Euljiro', transport: 'ë„ë³´: ì¶©ë¬´ë¡œì—­ 8ë²ˆ ì¶œêµ¬.' }] },
        { day: 7, date: '12/24 (ìˆ˜)', theme: 'ì„œìš¸ ì•ˆë…• & ê·€êµ­', activities: [{ time: '06:00', title: 'ì²´í¬ì•„ì›ƒ & ê³µí•­ ì´ë™', type: 'bus', desc: '6015 ê³µí•­ë²„ìŠ¤ íƒ‘ìŠ¹.', location: 'Airport Bus Stop', transport: 'ê³µí•­ë²„ìŠ¤: ì¶©ë¬´ë¡œì—­ 1ë²ˆ ì¶œêµ¬ ì•ž ì •ë¥˜ìž¥ (ì•½ 70-80ë¶„).' }, { time: '07:35', title: 'ì²´í¬ì¸ & í…ìŠ¤ë¦¬íŽ€', type: 'plane', desc: 'ì—ë°”í•­ê³µ ì¹´ìš´í„°.', location: 'ICN Airport' }, { time: '11:40', title: 'BR169 ì´ë¥™', type: 'flight', desc: 'ì¸ì²œ(ICN) -> íƒ€ì˜¤ìœ„ì•ˆ(TPE)', location: 'Departure Hall' }, { time: '13:30', title: 'ëŒ€ë§Œ ë„ì°©', type: 'home', desc: 'ì¦ê±°ìš´ ì—¬í–‰ ì¢…ë£Œ.', location: 'Taipei' }] }
      ];

      const days_EN = [
          { day: 1, date: '12/18 (Thu)', theme: 'Arrival & Check-in', activities: [{ time: '12:00', title: 'Leave Home', type: 'car', desc: 'Kenyi Pickup to TPE Airport.', location: 'Home', transport: 'Private Car' }, { time: '15:15', title: 'Flight BR160', type: 'flight', desc: 'TPE Terminal 2 -> ICN', location: 'TPE Airport' }, { time: '18:45', title: 'Arrival', type: 'arrival', desc: 'Immigration, Baggage, T-Money.', location: 'ICN Airport' }, { time: '20:00', title: 'To Wecostay', type: 'bus', desc: 'Bus 6015 to Chungmuro.', info: 'Cost: 17,000 KRW', customPhrases: [{ korean: 'G3 í˜¸í…”ì—ì„œ ë‚´ë ¤ì£¼ì„¸ìš”', pronunciation: 'G3 Hotel-eseo naeryeojuseyo', meaning: 'Please drop me at G3 Hotel' }], transport: 'Bus 6015 at Stop 5B/11B -> Chungmuro Stn (3 stops).' }, { time: '21:30', title: 'Check-in & Dinner', type: 'food', desc: 'Fried chicken or Army stew.', location: 'Chungmuro' }] },
          { day: 2, date: '12/19 (Fri)', theme: 'History & Culture', activities: [{ time: '10:00', title: 'Bukchon Hanok Village', type: 'sight', desc: 'Hanok Village & 8 Views.', location: 'Bukchon', transport: 'Line 3 Anguk Station (Exit 2).' }, { time: '12:30', title: 'Bukchon Samgyetang', type: 'food', desc: 'Famous Ginseng Chicken Soup nearby.', location: 'Bukchon', transport: 'Walk from Hanok Village.' }, { time: '14:30', title: 'Gyeongbokgung', type: 'sight', desc: 'Palace & Guard Ceremony.', location: 'Gyeongbokgung', transport: 'Walk west from Bukchon (15 mins).' }, { time: '17:00', title: 'Free Time', type: 'walk', desc: 'Explore nearby.', location: 'Gwanghwamun', transport: 'Walk.' }] },
          { day: 3, date: '12/20 (Sat)', theme: 'City Wall & Culture', activities: [{ time: '10:00', title: 'Dongdaemun Seonggwak Park', type: 'sight', desc: 'Seoul City Wall walk.', location: 'Dongdaemun', transport: 'Line 1/4 Dongdaemun Stn (Exit 1).' }, { time: '12:30', title: 'Insadong Lunch', type: 'food', desc: 'Traditional Korean Food.', location: 'Insadong', transport: 'Subway to Jonggak, then walk.' }, { time: '14:30', title: 'Insadong Shopping', type: 'shopping', desc: 'Ssamzigil & Crafts.', location: 'Insadong', transport: 'Walk nearby.' }, { time: '17:00', title: 'Cheonggyecheon', type: 'walk', desc: 'Stream walk.', location: 'Cheonggyecheon', transport: 'Walk south from Insadong.' }, { time: '19:00', title: 'Myeongdong', type: 'shopping', desc: 'Shopping and street food.', location: 'Myeongdong', transport: 'Walk: 10-15 mins from Cheonggyecheon.' }] },
          { day: 4, date: '12/21 (Sun)', theme: 'Relaxed Afternoon & Myeongdong', activities: [{ time: '10:00', title: 'Namsangol Hanok', type: 'sight', desc: 'Walk near accommodation.', location: 'Chungmuro', transport: 'Walk: 5 mins from Wecostay.' }, { time: '13:00', title: 'Lunch & Rest', type: 'food', desc: 'Lunch nearby & rest.', location: 'Wecostay' }, { time: '15:00', title: 'To Namsan Oreumi', type: 'sight', desc: 'Subway to Myeongdong, walk to elevator.', location: 'Namsan Oreumi', transport: 'Line 4 Chungmuro -> Myeongdong Exit 4 -> Straight -> Left at intersection.', visual: 'namsan_path', link: { text: 'Namsan Oreumi', url: 'https://www.bring-you.info/zh-tw/n-seoul-tower' } }, { time: '15:40', title: 'Namsan Cable Car', type: 'sight', desc: 'Cable car to Seoul Tower. (Open: 10:00 - 23:00)', location: 'Namsan Tower', transport: 'Oreumi Elevator -> Cable Car Station.' }, { time: '19:30', title: 'Myeongdong Dinner', type: 'food', desc: 'Leave tower and go shopping/dining in Myeongdong.', location: 'Myeongdong', transport: 'Descend via cable car, walk to Myeongdong.' }] },
          { day: 5, date: '12/22 (Mon)', theme: 'Modern Seoul & River', activities: [{ time: '11:00', title: 'The Hyundai Seoul', type: 'shopping', desc: 'Department Store.', location: 'Yeouido', transport: 'Line 4 Chungmuro -> Dongdaemun History (Transfer Line 5) -> Yeouinaru (Exit 1).' }, { time: '15:00', title: 'Hangang Park', type: 'walk', desc: 'Picnic by the river.', location: 'Yeouido', transport: 'Walk from Gate 1.' }, { time: '17:00', title: 'River Cruise', type: 'ship', desc: 'Eland Cruise night view.', location: 'Yeouido Dock', transport: 'Walk east along the river.' }, { time: '19:30', title: 'Hongdae Dinner', type: 'food', desc: 'Youth district.', location: 'Hongdae', transport: 'Line 5 -> Yeongdeungpo-gu Office (Transfer Line 2) -> Hongik Univ.' }] },
          { day: 6, date: '12/23 (Tue)', theme: 'Souvenirs & Chill', activities: [{ time: '10:30', title: 'Gwangjang Market', type: 'food', desc: 'Street food.', location: 'Gwangjang Market', transport: 'Line 4 -> Dongdaemun (Transfer Line 1) -> Jongno 5-ga (Exit 8).' }, { time: '14:00', title: 'Lotte Mart', type: 'shopping', desc: 'Seoul Station Branch.', location: 'Seoul Station', transport: 'Line 1 to Seoul Station.' }, { time: '17:00', title: 'Packing', type: 'hotel', desc: 'Pack luggage.', location: 'Wecostay', transport: 'Line 4 to Chungmuro.' }, { time: '19:00', title: 'Final Dinner', type: 'food', desc: 'Euljiro Hipjiro vibes.', location: 'Euljiro', transport: 'Walk from Chungmuro Exit 8.' }] },
          { day: 7, date: '12/24 (Wed)', theme: 'Departure', activities: [{ time: '06:00', title: 'To Airport', type: 'bus', desc: 'Bus 6015 to Incheon.', location: 'Airport Bus Stop', transport: 'Bus 6015 from Chungmuro Exit 1.' }, { time: '09:40', title: 'Check-in', type: 'plane', desc: 'Counter, Tax Refund.', location: 'ICN Airport' }, { time: '11:40', title: 'Flight BR169', type: 'flight', desc: 'ICN -> TPE', location: 'Departure Hall' }, { time: '13:30', title: 'Arrive Taiwan', type: 'home', desc: 'Home Sweet Home.', location: 'Taipei' }] }
      ];
      
      const days_JP = [
          { day: 1, date: '12/18 (æœ¨)', theme: 'ã‚½ã‚¦ãƒ«åˆ°ç€ & ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³', activities: [{ time: '12:00', title: 'è‡ªå®…ã‚’å‡ºç™º', type: 'car', desc: 'ç©ºæ¸¯é€è¿Žã§æ¡ƒåœ’ç©ºæ¸¯ã¸ã€‚', location: 'Home', transport: 'å°‚ç”¨è»Š' }, { time: '15:15', title: 'ã‚¨ãƒãƒ¼èˆªç©º BR160', type: 'flight', desc: 'æ¡ƒåœ’(TPE) -> ä»å·(ICN)', location: 'TPE Airport' }, { time: '18:45', title: 'ä»å·ç©ºæ¸¯åˆ°ç€', type: 'arrival', desc: 'å…¥å›½å¯©æŸ»ã€è·ç‰©å—å–ã€T-Moneyè³¼å…¥ã€‚', location: 'ICN Airport' }, { time: '20:00', title: 'Wecostayã¸', type: 'bus', desc: '6015ãƒã‚¹ã§å¿ æ­¦è·¯ã¸ã€‚', info: 'è²»ç”¨: 17,000 KRW', customPhrases: [{ korean: 'G3 í˜¸í…”ì—ì„œ ë‚´ë ¤ì£¼ì„¸ìš”', pronunciation: 'G3 Hotel-eseo naeryeojuseyo', meaning: 'G3ãƒ›ãƒ†ãƒ«ã§é™ã‚ã—ã¦ãã ã•ã„' }], transport: 'ä»å·ç©ºæ¸¯ 5B/11Bä¹—ã‚Šå ´ ã€6015ãƒã‚¹ã€‘(æ˜Žæ´žæ–¹é¢)ã€3é§…(ç´„70åˆ†)ã€ã€Œå¿ æ­¦è·¯é§…ã€ä¸‹è»Šã€‚' }, { time: '21:30', title: 'ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³ & å¤•é£Ÿ', type: 'food', desc: 'ãƒã‚­ãƒ³ã‚„ãƒ—ãƒ‡ãƒã‚²ã€‚', location: 'Chungmuro' }] },
          { day: 2, date: '12/19 (é‡‘)', theme: 'æ­´å²æ•£ç­– & ä¼çµ±', activities: [{ time: '10:00', title: 'åŒ—æ‘éŸ“å±‹æ‘ & å…«æ™¯', type: 'sight', desc: 'éŸ“å±‹æ‘æ•£ç­–ã€‚', location: 'Bukchon', transport: '3å·ç·š å®‰å›½é§… (2ç•ªå‡ºå£)ã€‚' }, { time: '12:30', title: 'åŒ—æ‘å‚é¶æ¹¯', type: 'food', desc: 'è¿‘ãã§å‚é¶æ¹¯ãƒ©ãƒ³ãƒã€‚', location: 'Bukchon', transport: 'å¾’æ­©ï¼šéŸ“å±‹æ‘ã‹ã‚‰ã€‚' }, { time: '14:30', title: 'æ™¯ç¦å®® & å…‰åŒ–é–€', type: 'sight', desc: 'çŽ‹å®®ã¨åºƒå ´ã€‚', location: 'Gyeongbokgung', transport: 'å¾’æ­©ï¼šåŒ—æ‘ã‹ã‚‰è¥¿ã¸15åˆ†ã€‚' }, { time: '17:00', title: 'è‡ªç”±æ™‚é–“', type: 'walk', desc: 'å‘¨è¾ºæ•£ç­–ã€‚', location: 'Gwanghwamun', transport: 'å¾’æ­©ã€‚' }] },
          { day: 3, date: '12/20 (åœŸ)', theme: 'åŸŽéƒ­ & æ–‡åŒ–', activities: [{ time: '10:00', title: 'æ±å¤§é–€åŸŽéƒ­å…¬åœ’', type: 'sight', desc: 'ã‚½ã‚¦ãƒ«åŸŽéƒ­æ•£æ­©ã€‚', location: 'Dongdaemun', transport: '1å·ç·š/4å·ç·š æ±å¤§é–€é§… (1ç•ªå‡ºå£)ã€‚' }, { time: '12:30', title: 'ä»å¯ºæ´žãƒ©ãƒ³ãƒ', type: 'food', desc: 'ä¼çµ±çš„ãªéŸ“å›½æ–™ç†ã€‚', location: 'Insadong', transport: 'åœ°ä¸‹é‰„ï¼šé¾è·¯3è¡—ã¸ç§»å‹•ã€‚' }, { time: '14:30', title: 'ä»å¯ºæ´žã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°', type: 'shopping', desc: 'ã‚µãƒ ã‚¸ã‚­ãƒ«ã€å·¥èŠ¸å“ã€‚', location: 'Insadong', transport: 'å¾’æ­©ã€‚' }, { time: '17:00', title: 'æ¸…æ¸“å·æ•£æ­©', type: 'walk', desc: 'å¤•æ–¹ã®å·æ²¿ã„æ•£æ­©ã€‚', location: 'Cheonggyecheon', transport: 'å¾’æ­©ï¼šä»å¯ºæ´žã‹ã‚‰å—ã¸ã€‚' }, { time: '19:00', title: 'æ˜Žæ´ž', type: 'shopping', desc: 'ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°ã¨å±‹å°ã‚°ãƒ«ãƒ¡ã€‚', location: 'Myeongdong', transport: 'å¾’æ­©ï¼šæ¸…æ¸“å·ã‹ã‚‰ä¹™æ”¯è·¯æ–¹é¢ã¸ç´„10-15åˆ†ã€‚' }] },
          { day: 4, date: '12/21 (æ—¥)', theme: 'ã‚†ã£ãŸã‚Šåˆå¾Œ & æ˜Žæ´žã‚°ãƒ«ãƒ¡', activities: [{ time: '10:00', title: 'å—å±±è°·éŸ“å±‹æ‘', type: 'sight', desc: 'å®¿ã®è¿‘ãã‚’æ•£æ­©ã€‚', location: 'Chungmuro', transport: 'å¾’æ­©ï¼šWecostayã‹ã‚‰ç´„5åˆ†ã€‚' }, { time: '13:00', title: 'ãƒ©ãƒ³ãƒ & ä¼‘æ†©', type: 'food', desc: 'è¿‘å ´ã§é£Ÿäº‹ï¼†ä¼‘æ†©ã€‚', location: 'Wecostay' }, { time: '15:00', title: 'å—å±±ã‚ªãƒ«ãƒŸã¸', type: 'sight', desc: 'æ˜Žæ´žé§…ã¸ç§»å‹•ã—ã€é€æ˜Žã‚¨ãƒ¬ãƒ™ãƒ¼ã‚¿ãƒ¼ã¸ã€‚', location: 'Namsan Oreumi', transport: '4å·ç·š å¿ æ­¦è·¯ -> æ˜Žæ´žé§…4ç•ªå‡ºå£ -> ç›´é€² -> ä¼šè³¢äº¤å·®ç‚¹å·¦æŠ˜ã€‚', visual: 'namsan_path', link: { text: 'Namsan Oreumi', url: 'https://www.bring-you.info/zh-tw/n-seoul-tower' } }, { time: '15:40', title: 'å—å±±ã‚±ãƒ¼ãƒ–ãƒ«ã‚«ãƒ¼', type: 'sight', desc: 'ã‚±ãƒ¼ãƒ–ãƒ«ã‚«ãƒ¼ã§ã‚½ã‚¦ãƒ«ã‚¿ãƒ¯ãƒ¼ã¸ã€‚(å–¶æ¥­æ™‚é–“: 10:00 - 23:00)', location: 'Namsan Tower', transport: 'ã‚ªãƒ«ãƒŸã‚¨ãƒ¬ãƒ™ãƒ¼ã‚¿ãƒ¼ -> ã‚±ãƒ¼ãƒ–ãƒ«ã‚«ãƒ¼ä¹—ã‚Šå ´ã€‚' }, { time: '19:30', title: 'æ˜Žæ´žã¸ç§»å‹• & å¤•é£Ÿ', type: 'food', desc: 'ã‚¿ãƒ¯ãƒ¼ã‹ã‚‰æ˜Žæ´žã¸ç§»å‹•ã—ã€ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°ã¨é£Ÿäº‹ã€‚', location: 'Myeongdong', transport: 'ã‚±ãƒ¼ãƒ–ãƒ«ã‚«ãƒ¼ä¸‹å±±å¾Œã€å¾’æ­©ã€‚' }] },
          { day: 5, date: '12/22 (æœˆ)', theme: 'ç¾ä»£ã‚½ã‚¦ãƒ« & æ¼¢æ±Ÿå¤œæ™¯', activities: [{ time: '11:00', title: 'The Hyundai Seoul', type: 'shopping', desc: 'æ±çŸ£å³¶ã®å·¨å¤§ãƒ‡ãƒ‘ãƒ¼ãƒˆã€‚', location: 'Yeouido', transport: 'åœ°ä¸‹é‰„ï¼š4å·ç·š å¿ æ­¦è·¯ -> æ±å¤§é–€æ­´å²(5å·ç·šä¹—æ›) -> ãƒ¨ã‚¤ãƒŠãƒ«(1ç•ªå‡ºå£)ã€‚' }, { time: '15:00', title: 'æ¼¢æ±Ÿå…¬åœ’', type: 'walk', desc: 'æ•£æ­©ã€æ¼¢æ±Ÿãƒ©ãƒ¼ãƒ¡ãƒ³ã€‚', location: 'Yeouido', transport: 'å¾’æ­©ï¼šã‚¶ãƒ»ç¾ä»£1ç•ªã‚²ãƒ¼ãƒˆå‘ã‹ã„ã€‚' }, { time: '17:00', title: 'æ¼¢æ±ŸéŠè¦§èˆ¹', type: 'ship', desc: 'ã‚¤ãƒ¼ãƒ©ãƒ³ãƒ‰ã‚¯ãƒ«ãƒ¼ã‚ºã€‚', location: 'Yeouido Dock', transport: 'å¾’æ­©ï¼šæ¼¢æ±Ÿæ²¿ã„ã‚’æ±ã¸10-15åˆ†ã€‚' }, { time: '19:30', title: 'å¼˜å¤§ãƒ‡ã‚£ãƒŠãƒ¼', type: 'food', desc: 'è‹¥è€…ã®è¡—ã€‚', location: 'Hongdae', transport: 'åœ°ä¸‹é‰„ï¼š5å·ç·š -> æ°¸ç™»æµ¦åŒºåº(2å·ç·šä¹—æ›) -> å¼˜å¤§å…¥å£(9ç•ªå‡ºå£)ã€‚' }] },
          { day: 6, date: '12/23 (ç«)', theme: 'ãŠåœŸç”£ & ãƒªãƒ©ãƒƒã‚¯ã‚¹', activities: [{ time: '10:30', title: 'åºƒè”µå¸‚å ´', type: 'food', desc: 'ãƒ”ãƒ³ãƒ‡ãƒˆãƒƒã€ãƒ¦ãƒƒã‚±ã€‚', location: 'Gwangjang Market', transport: 'åœ°ä¸‹é‰„ï¼š4å·ç·š å¿ æ­¦è·¯ -> æ±å¤§é–€(1å·ç·šä¹—æ›) -> é¾è·¯5è¡—(8ç•ªå‡ºå£)ã€‚' }, { time: '14:00', title: 'ãƒ­ãƒƒãƒ†ãƒžãƒ¼ãƒˆ', type: 'shopping', desc: 'ã‚½ã‚¦ãƒ«é§…åº—ã§è²·ã„ç‰©ã€‚', location: 'Seoul Station', transport: 'åœ°ä¸‹é‰„ï¼š1å·ç·š ã‚½ã‚¦ãƒ«é§…ã€‚' }, { time: '17:00', title: 'ãƒ‘ãƒƒã‚­ãƒ³ã‚°', type: 'hotel', desc: 'è·é€ ã‚Šã€‚', location: 'Wecostay', transport: 'åœ°ä¸‹é‰„ï¼š4å·ç·šã§å¿ æ­¦è·¯ã¸ã€‚' }, { time: '19:00', title: 'æœ€å¾Œã®å¤•é£Ÿ', type: 'food', desc: 'ä¹™æ”¯è·¯ (Hipjiro)ã€‚', location: 'Euljiro', transport: 'å¾’æ­©ï¼šå¿ æ­¦è·¯é§…8ç•ªå‡ºå£ã‹ã‚‰ã€‚' }] },
          { day: 7, date: '12/24 (æ°´)', theme: 'å¸°å›½ (ä»™å°)', activities: [{ time: '06:00', title: 'ç©ºæ¸¯ã¸ç§»å‹•', type: 'bus', desc: '6015 ç©ºæ¸¯ãƒã‚¹ã€‚', location: 'Airport Bus Stop', transport: 'ç©ºæ¸¯ãƒã‚¹ï¼šå¿ æ­¦è·¯é§…1ç•ªå‡ºå£å‰ (ç´„70åˆ†)ã€‚' }, { time: '07:35', title: 'ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³', type: 'plane', desc: 'æ­ä¹—æ‰‹ç¶šã & å…ç¨Žæ‰‹ç¶šãã€‚', location: 'ICN Airport' }, { time: '09:35', title: 'ä»™å°è¡Œãå‡ºç™º', type: 'flight', desc: 'ä»å·(ICN) -> ä»™å°(SDJ)', location: 'Departure Hall' }, { time: '11:45', title: 'ä»™å°åˆ°ç€', type: 'home', desc: 'ãŠç–²ã‚Œæ§˜ã§ã—ãŸã€‚', location: 'Sendai Airport' }] }
      ];

      const data = {
        ZH: [day0_ZH, ...days_ZH],
        KR: [day0_KR, ...days_KR],
        EN: [day0_EN, ...days_EN],
        JP: [day0_JP, ...days_JP]
      };
      return data[lang];
    };

    // --- Components ---
    const ShoppingListContent = ({ lang }) => {
      const [items, setItems] = useState([]);
      const [newItem, setNewItem] = useState({ name: '', category: '', image: '' });
      const [viewMode, setViewMode] = useState('list');
      const fileInputRef = useRef(null);

      // Separate key for each language
      const storageKey = `seoul2025_shopping_list_v2_${lang}`; 

      useEffect(() => {
        try {
          const saved = localStorage.getItem(storageKey);
          if (saved) setItems(JSON.parse(saved));
        } catch (e) { console.error(e); }
      }, [storageKey]);

      useEffect(() => {
        localStorage.setItem(storageKey, JSON.stringify(items));
      }, [items, storageKey]);

      const handleAddItem = () => {
        if (!newItem.name) return;
        setItems([...items, { ...newItem, id: Date.now(), checked: false }]);
        setNewItem({ name: '', category: '', image: '' });
      };

      const handleDeleteItem = (id) => {
        if (!confirm('Delete?')) return;
        setItems(items.filter(i => i.id !== id));
      };

      const toggleItemCheck = (id) => {
        setItems(items.map(i => i.id === id ? { ...i, checked: !i.checked } : i));
      };

      const handleFileChange = (e) => {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onloadend = () => {
            setNewItem(prev => ({ ...prev, image: reader.result }));
          };
          reader.readAsDataURL(file);
        }
      };

      return (
          <div className="flex flex-col h-full bg-white rounded-2xl shadow-sm border border-stone-100 overflow-hidden">
            <div className="bg-gradient-to-r from-rose-300 to-rose-400 p-3 text-white font-bold text-center flex justify-between items-center shrink-0">
              <div className="flex items-center gap-2 text-sm"><ShoppingBag size={18} /> {UI_LABELS[lang].shoppingList}</div>
              <div className="flex gap-1">
                 <button onClick={() => setViewMode('list')} className={`p-1 rounded ${viewMode === 'list' ? 'bg-white/20' : ''}`}><List size={16}/></button>
                 <button onClick={() => setViewMode('grid')} className={`p-1 rounded ${viewMode === 'grid' ? 'bg-white/20' : ''}`}><LayoutGrid size={16}/></button>
              </div>
            </div>
            
            <div className="p-3 overflow-y-auto flex-1 min-h-[300px]">
               {viewMode === 'list' ? (
                 <div className="space-y-2">
                   {items.map(item => (
                     <div key={item.id} className={`flex items-center p-2 rounded-lg border ${item.checked ? 'bg-gray-50 border-gray-100' : 'bg-white border-rose-100'}`}>
                        <input type="checkbox" checked={item.checked} onChange={() => toggleItemCheck(item.id)} className="w-4 h-4 mr-3 accent-rose-400" />
                        {item.image && <img src={item.image} className="w-10 h-10 rounded object-cover mr-3 border" alt="item" />}
                        <div className="flex-1 min-w-0">
                           <div className={`font-bold text-sm truncate ${item.checked ? 'line-through text-gray-400' : 'text-gray-800'}`}>{item.name}</div>
                           <div className="text-xs text-gray-500 truncate">{item.category}</div>
                        </div>
                        <button onClick={() => handleDeleteItem(item.id)} className="text-gray-300 hover:text-red-400 ml-2"><Trash2 size={14}/></button>
                     </div>
                   ))}
                 </div>
               ) : (
                 <div className="grid grid-cols-2 gap-2">
                    {items.map(item => (
                      <div key={item.id} className={`relative rounded-xl border overflow-hidden aspect-square group ${item.checked ? 'opacity-60' : ''}`}>
                         {item.image ? (
                            <img src={item.image} className="w-full h-full object-cover" alt={item.name} />
                         ) : (
                            <div className="w-full h-full bg-rose-50 flex items-center justify-center text-rose-200"><ShoppingBag size={32}/></div>
                         )}
                         <div className="absolute bottom-0 left-0 right-0 bg-black/60 p-1.5 text-white">
                            <div className="text-xs font-bold truncate">{item.name}</div>
                            <div className="text-[10px] opacity-80 truncate">{item.category}</div>
                         </div>
                         <input type="checkbox" checked={item.checked} onChange={() => toggleItemCheck(item.id)} className="absolute top-2 right-2 w-4 h-4 accent-rose-400" />
                         <button onClick={() => handleDeleteItem(item.id)} className="absolute top-2 left-2 text-white/80 hover:text-red-400"><Trash2 size={14}/></button>
                      </div>
                    ))}
                 </div>
               )}
               {items.length === 0 && <div className="text-center text-gray-400 py-10 text-sm">å°šç„¡å•†å“</div>}
            </div>

            <div className="p-3 border-t bg-gray-50 shrink-0 space-y-2">
                <div className="flex gap-2">
                   <input className="flex-1 border rounded p-2 text-xs outline-none focus:ring-1 focus:ring-rose-300" placeholder={UI_LABELS[lang].shoppingName} value={newItem.name} onChange={e => setNewItem({...newItem, name: e.target.value})} />
                   <input className="w-1/3 border rounded p-2 text-xs outline-none focus:ring-1 focus:ring-rose-300" placeholder={UI_LABELS[lang].shoppingCategory} value={newItem.category} onChange={e => setNewItem({...newItem, category: e.target.value})} />
                </div>
                <div className="flex gap-2">
                   <div className="flex-1 flex items-center border rounded bg-white px-2">
                      <input className="flex-1 text-xs outline-none bg-transparent" placeholder={UI_LABELS[lang].shoppingImage} value={newItem.image} onChange={e => setNewItem({...newItem, image: e.target.value})} />
                      <button onClick={() => fileInputRef.current?.click()} className="p-1 text-gray-500 hover:text-rose-500"><ImageIcon size={16}/></button>
                      <input type="file" ref={fileInputRef} className="hidden" accept="image/*" onChange={handleFileChange} />
                   </div>
                   <button onClick={handleAddItem} disabled={!newItem.name} className="bg-rose-400 text-white px-3 rounded font-bold text-xs disabled:opacity-50 whitespace-nowrap">{UI_LABELS[lang].shoppingAdd}</button>
                </div>
            </div>
          </div>
      );
    };

    const IconType = ({ type, className }) => {
      const icons = { 
        checklist: ClipboardCheck, warning: AlertTriangle, warning_red: AlertTriangle, doc: FileText, ses: Scan, 
        flight: Plane, arrival: Plane, bus: Bus, car: Car, train: Train, food: Utensils, music: Music, sight: Camera, shopping: ShoppingBag, hotel: BedDouble, ship: Ship, walk: Footprints, show: Ticket, home: Home, default: MapPin 
      };
      const Icon = icons[type] || icons.default;
      return <Icon className={`${className} ${type === 'arrival' ? 'rotate-90' : ''} ${type === 'warning_red' ? 'text-red-500' : ''} ${type === 'warning' ? 'text-amber-500' : ''} ${type === 'ses' ? 'text-blue-500' : ''}`} />;
    };

    // Transport Formatter Component
    const TransportDisplay = ({ text }) => {
      if (!text) return null;
      const parts = text.split(/([1-9]è™Ÿç·š|Line\s*[1-9]|AREX|[1-9]í˜¸ì„ |[1-9]å·ç·š)/g);
      return (
        <span className="inline-flex flex-wrap items-center gap-1 align-middle ml-1">
          {parts.map((part, idx) => {
            let color = null;
            if (part.match(/1è™Ÿç·š|Line\s*1|1í˜¸ì„ |1å·ç·š/)) color = SUBWAY_COLORS['1'];
            else if (part.match(/2è™Ÿç·š|Line\s*2|2í˜¸ì„ |2å·ç·š/)) color = SUBWAY_COLORS['2'];
            else if (part.match(/3è™Ÿç·š|Line\s*3|3í˜¸ì„ |3å·ç·š/)) color = SUBWAY_COLORS['3'];
            else if (part.match(/4è™Ÿç·š|Line\s*4|4í˜¸ì„ |4å·ç·š/)) color = SUBWAY_COLORS['4'];
            else if (part.match(/5è™Ÿç·š|Line\s*5|5í˜¸ì„ |5å·ç·š/)) color = SUBWAY_COLORS['5'];
            else if (part.match(/6è™Ÿç·š|Line\s*6|6í˜¸ì„ |6å·ç·š/)) color = SUBWAY_COLORS['6'];
            else if (part.match(/7è™Ÿç·š|Line\s*7|7í˜¸ì„ |7å·ç·š/)) color = SUBWAY_COLORS['7'];
            else if (part.match(/8è™Ÿç·š|Line\s*8|8í˜¸ì„ |8å·ç·š/)) color = SUBWAY_COLORS['8'];
            else if (part.match(/9è™Ÿç·š|Line\s*9|9í˜¸ì„ |9å·ç·š/)) color = SUBWAY_COLORS['9'];
            else if (part.match(/AREX/i)) color = SUBWAY_COLORS['AREX'];

            if (color) {
              return <span key={idx} className="px-1.5 py-0.5 rounded text-white font-bold text-[10px] inline-block" style={{ backgroundColor: color }}>{part}</span>;
            }
            return part.trim() ? <span key={idx} className="text-xs text-stone-500">{part}</span> : null;
          })}
        </span>
      );
    };

    const ActivityWeather = ({ day, index, location }) => {
      const isTaiwan = location && ['Home', 'TPE', 'Taipei', 'Taiwan', 'Taoyuan', 'å®¶', 'æ¡ƒåœ’', 'å°åŒ—', 'å°ç£'].some(k => location.includes(k));
      const seed = day * 10 + index;
      let weatherTypes, temp;
      if (isTaiwan) {
        weatherTypes = ['sunny', 'cloudy', 'rain']; 
        temp = Math.floor((seed * 9301 + 49297) % 8) + 15;
      } else {
        weatherTypes = ['sunny', 'cloudy', 'snow'];
        temp = Math.floor((seed * 9301 + 49297) % 15) - 10; 
      }
      const type = weatherTypes[seed % weatherTypes.length];
      const getIcon = () => {
        if (type === 'sunny') return <Sun className="w-3 h-3 text-amber-400" />;
        if (type === 'snow') return <Snowflake className="w-3 h-3 text-sky-300" />;
        if (type === 'rain') return <CloudRain className="w-3 h-3 text-slate-400" />;
        return <Cloud className="w-3 h-3 text-slate-400" />;
      };
      return (
        <div className="flex items-center gap-1 text-[10px] font-medium text-stone-500 bg-stone-50 px-1.5 py-0.5 rounded-full shrink-0 ml-2">
          {getIcon()}
          <span>{temp}Â°</span>
        </div>
      );
    };

    const TimeWeatherWidget = () => {
      const [time, setTime] = useState(new Date());
      const [temp, setTemp] = useState(-2);
      const [condition, setCondition] = useState('cloudy');
      useEffect(() => { const t = setInterval(() => setTime(new Date()), 1000); return () => clearInterval(t); }, []);
      const seoulTime = new Date(time.toLocaleString("en-US", { timeZone: "Asia/Seoul" }));
      const getIcon = () => {
        if (condition === 'sunny') return <Sun className="w-4 h-4 text-amber-400" />;
        if (condition === 'snow') return <Snowflake className="w-4 h-4 text-sky-300" />;
        return <Cloud className="w-4 h-4 text-slate-400" />;
      };
      return (
        <div className="flex flex-col items-end gap-1">
           <div className="flex items-center gap-2 bg-white/80 backdrop-blur-md px-3 py-1 md:px-4 md:py-2 rounded-2xl shadow-sm border border-rose-100">
             <div className="flex flex-col items-end border-r border-rose-100 pr-2 md:pr-4">
               <span className="text-[8px] md:text-[10px] text-rose-800 font-bold tracking-wider">SEOUL</span>
               <span className="text-lg md:text-xl font-mono font-bold text-rose-900 leading-none">{seoulTime.getHours().toString().padStart(2,'0')}:{seoulTime.getMinutes().toString().padStart(2,'0')}</span>
             </div>
             <div className="flex items-center gap-2">{getIcon()}<span className="text-lg font-bold text-stone-700">{temp}Â°C</span></div>
           </div>
        </div>
      );
    };

    const RealTimeDateDisplay = () => {
      const [dateStr, setDateStr] = useState('');
      useEffect(() => {
        const updateDate = () => {
          const now = new Date();
          const seoulTime = new Date(now.toLocaleString("en-US", { timeZone: "Asia/Seoul" }));
          const y = seoulTime.getFullYear();
          const m = String(seoulTime.getMonth() + 1).padStart(2, '0');
          const d = String(seoulTime.getDate()).padStart(2, '0');
          const days = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
          const dayName = days[seoulTime.getDay()];
          setDateStr(`${y}/${m}/${d} (${dayName})`);
        };
        updateDate();
        const timer = setInterval(updateDate, 60000);
        return () => clearInterval(timer);
      }, []);
      return <span className="text-sm font-bold text-rose-900/90 mt-0.5 block">{dateStr}</span>;
    };

    const EditableText = ({ text, className, multiline = false, onSave }) => {
      const [isEditing, setIsEditing] = useState(false);
      const [value, setValue] = useState(text);
      useEffect(() => setValue(text), [text]);
      const handleBlur = () => { setIsEditing(false); onSave(value); };
      if (isEditing) return multiline ? <textarea autoFocus className={`w-full bg-white border border-rose-300 rounded p-2 focus:ring-2 focus:ring-rose-400 outline-none text-stone-700 ${className}`} value={value} onChange={(e) => setValue(e.target.value)} onBlur={handleBlur} rows={3} /> : <input autoFocus type="text" className={`w-full bg-white border border-rose-300 rounded px-1 focus:ring-2 focus:ring-rose-400 outline-none text-stone-700 ${className}`} value={value} onChange={(e) => setValue(e.target.value)} onBlur={handleBlur} />;
      return <div onClick={() => setIsEditing(true)} className={`cursor-pointer hover:bg-rose-50/50 rounded px-1 transition-colors border border-transparent hover:border-rose-100 group relative ${className}`}>{value}<Edit3 className="w-3 h-3 text-rose-300 absolute -right-4 top-1 opacity-0 group-hover:opacity-100 transition-opacity" /></div>;
    };

    const MagicPhraseModal = ({ activity, lang, onClose, onSavePhrases }) => {
      const [phrases, setPhrases] = useState([]);
      const [isAdding, setIsAdding] = useState(false);
      const [newMeaning, setNewMeaning] = useState('');
      const [newKorean, setNewKorean] = useState('');
      const [newPronunciation, setNewPronunciation] = useState('');
      
      useEffect(() => {
        const fallback = getFallbackPhrases(activity.type, lang);
        const custom = activity.customPhrases || [];
        setPhrases([...custom, ...fallback]);
      }, [activity, lang]);

      const handleAddPhrase = () => {
        if (!newMeaning || !newKorean) return;
        const newPhrase = { meaning: newMeaning, korean: newKorean, pronunciation: newPronunciation };
        const updatedCustom = [...(activity.customPhrases || []), newPhrase];
        
        onSavePhrases(updatedCustom); 
        setPhrases([...updatedCustom, ...getFallbackPhrases(activity.type, lang)]);
        
        setNewMeaning('');
        setNewKorean('');
        setNewPronunciation('');
        setIsAdding(false);
      };

      const handleDeletePhrase = (index) => {
        const customCount = (activity.customPhrases || []).length;
        if (index < customCount) {
             const updatedCustom = [...(activity.customPhrases || [])];
             updatedCustom.splice(index, 1);
             onSavePhrases(updatedCustom);
             setPhrases([...updatedCustom, ...getFallbackPhrases(activity.type, lang)]);
        }
      };

      const speak = (text) => {
        window.speechSynthesis.cancel();
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = 'ko-KR';
        utterance.rate = 0.9;
        window.speechSynthesis.speak(utterance);
      };

      const handleTranslate = () => {
        if (!newMeaning) return;
        const slMap = { ZH: 'zh-TW', KR: 'ko', EN: 'en', JP: 'ja' };
        const sl = slMap[lang] || 'auto';
        window.open(`https://translate.google.com/?sl=${sl}&tl=ko&text=${encodeURIComponent(newMeaning)}&op=translate`, '_blank');
      };

      return (
        <div className="fixed inset-0 bg-black/40 backdrop-blur-sm z-[60] flex items-center justify-center p-4" onClick={onClose}>
          <div className="bg-white rounded-3xl shadow-2xl max-w-sm w-full overflow-hidden animate-fade-in flex flex-col max-h-[80vh]" onClick={(e) => e.stopPropagation()}>
            <div className="bg-gradient-to-r from-rose-300 to-rose-400 p-4 flex justify-between items-center text-white shrink-0">
              <div className="flex items-center gap-2"><Languages size={20} /><div><h3 className="font-bold text-sm">{UI_LABELS[lang].phrasesTitle}</h3><p className="text-[10px] opacity-90 truncate max-w-[200px]">{activity.title}</p></div></div>
              <button onClick={onClose}><X size={20} /></button>
            </div>
            <div className="p-4 overflow-y-auto flex-1 space-y-3">
              {phrases.map((p, i) => (
                <div key={i} className="bg-rose-50 rounded-xl p-3 border border-rose-100 flex justify-between items-center gap-2 relative group">
                  <div className="flex-1"><span className="font-bold text-rose-900 block">{p.korean}</span><div className="text-xs text-rose-600/80">{p.pronunciation}</div><div className="text-sm text-stone-600">{p.meaning}</div></div>
                  <div className="flex flex-col gap-1">
                    <button onClick={() => speak(p.korean)} className="p-2 bg-white text-rose-400 rounded-full shadow-sm"><Volume2 size={18} /></button>
                    {i < (activity.customPhrases || []).length && (
                        <button onClick={() => handleDeletePhrase(i)} className="p-2 bg-white text-red-400 rounded-full shadow-sm"><Trash2 size={18} /></button>
                    )}
                  </div>
                </div>
              ))}
            </div>
            
            <div className="p-3 border-t bg-stone-50 shrink-0">
                {!isAdding ? (
                    <button 
                        onClick={() => setIsAdding(true)}
                        className="w-full py-2 rounded-xl border-2 border-dashed border-rose-200 text-rose-400 font-bold text-sm hover:bg-rose-50 hover:border-rose-300 transition-colors flex items-center justify-center gap-1"
                    >
                        <Plus size={16} /> {UI_LABELS[lang].addPhrase || 'æ–°å¢žè‡ªè¨‚çŸ­å¥'}
                    </button>
                ) : (
                    <div className="space-y-2 animate-fade-in">
                        <div className="flex justify-between items-center mb-1">
                            <div className="text-xs font-bold text-stone-500">æ–°å¢žè‡ªè¨‚çŸ­å¥</div>
                            <button onClick={() => setIsAdding(false)} className="text-stone-400 hover:text-stone-600"><XCircle size={16}/></button>
                        </div>
                        <div className="flex gap-2">
                            <input className="flex-1 border rounded p-1.5 text-sm outline-none focus:ring-1 focus:ring-rose-300" placeholder={UI_LABELS[lang].phraseMeaningPlaceholder} value={newMeaning} onChange={e => setNewMeaning(e.target.value)} />
                            <button onClick={handleTranslate} className="bg-blue-100 text-blue-600 px-2 rounded text-xs flex items-center gap-1 whitespace-nowrap"><Search size={12}/> ç¿»è­¯</button>
                        </div>
                        <input className="w-full border rounded p-1.5 text-sm outline-none focus:ring-1 focus:ring-rose-300" placeholder="éŸ“æ–‡ (è²¼ä¸Šç¿»è­¯çµæžœ)" value={newKorean} onChange={e => setNewKorean(e.target.value)} />
                        <input className="w-full border rounded p-1.5 text-sm outline-none focus:ring-1 focus:ring-rose-300" placeholder="ç™¼éŸ³ (é¸å¡«)" value={newPronunciation} onChange={e => setNewPronunciation(e.target.value)} />
                        <div className="flex gap-2">
                            <button onClick={() => setIsAdding(false)} className="flex-1 bg-stone-200 text-stone-600 py-2 rounded-lg font-bold text-sm">å–æ¶ˆ</button>
                            <button onClick={handleAddPhrase} disabled={!newMeaning || !newKorean} className="flex-1 bg-rose-400 text-white py-2 rounded-lg font-bold text-sm disabled:opacity-50">ç¢ºèªæ–°å¢ž</button>
                        </div>
                    </div>
                )}
            </div>
          </div>
        </div>
      );
    };

    const AIChatWidget = ({ itinerary, lang }) => {
      const [isOpen, setIsOpen] = useState(false);
      const [messages, setMessages] = useState([]);
      const [input, setInput] = useState("");
      const [loading, setLoading] = useState(false);
      const scrollRef = useRef(null);
      useEffect(() => { if (scrollRef.current) scrollRef.current.scrollTop = scrollRef.current.scrollHeight; }, [messages, isOpen]);
      const handleSend = async () => {
        if (!input.trim()) return;
        const userMsg = { role: 'user', text: input };
        setMessages(prev => [...prev, userMsg]);
        setInput("");
        setLoading(true);
        const result = await callGeminiAPI(input, `You are a Seoul guide. Context: ${JSON.stringify(itinerary)}. Lang: ${lang}. Keep it short.`);
        setMessages(prev => [...prev, { role: 'model', text: result.success ? result.data : "Network error." }]);
        setLoading(false);
      };
      return (
        <>
          {!isOpen && <button onClick={() => setIsOpen(true)} className="fixed bottom-6 right-6 bg-gradient-to-br from-rose-400 to-rose-500 text-white p-4 rounded-full shadow-lg hover:scale-105 transition-all z-40"><Bot size={28} /></button>}
          {isOpen && (
            <div className="fixed bottom-6 right-6 w-[90vw] md:w-[380px] h-[500px] bg-white rounded-3xl shadow-2xl z-50 flex flex-col overflow-hidden border border-rose-100 animate-fade-in">
              <div className="bg-gradient-to-r from-rose-400 to-rose-500 p-4 flex justify-between text-white"><div className="flex gap-2 items-center"><Sparkles size={18} /><h3>{UI_LABELS[lang].aiChat}</h3></div><button onClick={() => setIsOpen(false)}><X size={20} /></button></div>
              <div className="flex-1 overflow-y-auto p-4 space-y-4 bg-stone-50" ref={scrollRef}>
                {messages.map((m, i) => (<div key={i} className={`flex ${m.role === 'user' ? 'justify-end' : 'justify-start'}`}><div className={`max-w-[85%] rounded-2xl p-3 text-sm ${m.role === 'user' ? 'bg-rose-400 text-white' : 'bg-white shadow-sm'}`}>{m.text}</div></div>))}
                {loading && <Loader2 className="animate-spin text-rose-400" />}
              </div>
              <div className="p-3 border-t"><div className="flex gap-2 bg-stone-100 rounded-full px-4 py-2"><input className="flex-1 bg-transparent outline-none text-sm" value={input} onChange={e => setInput(e.target.value)} onKeyDown={e => e.key === 'Enter' && handleSend()} placeholder={UI_LABELS[lang].chatPlaceholder} /><button onClick={handleSend}><Send size={18} className="text-rose-400" /></button></div></div>
            </div>
          )}
        </>
      );
    };

    const AddEventModal = ({ onClose, onSave, lang }) => {
      const [time, setTime] = useState('');
      const [title, setTitle] = useState('');
      const handleSave = () => { if (!title) return; onSave(time || '00:00', title); };
      return (
        <div className="fixed inset-0 bg-black/50 backdrop-blur-sm z-[80] flex items-center justify-center p-4">
          <div className="bg-white rounded-2xl shadow-2xl w-full max-w-sm overflow-hidden animate-fade-in">
            <div className="bg-rose-400 p-4 text-white font-bold text-center">{UI_LABELS[lang].addModalTitle}</div>
            <div className="p-5 space-y-4">
              <div><label className="block text-xs text-stone-500 mb-1">{UI_LABELS[lang].addModalTime}</label><input type="time" className="w-full border border-stone-200 rounded-lg p-2 text-stone-700 outline-none focus:ring-2 focus:ring-rose-300" value={time} onChange={(e) => setTime(e.target.value)} /></div>
              <div><label className="block text-xs text-stone-500 mb-1">{UI_LABELS[lang].addModalContent}</label><input type="text" className="w-full border border-stone-200 rounded-lg p-2 text-stone-700 outline-none focus:ring-2 focus:ring-rose-300" value={title} onChange={(e) => setTitle(e.target.value)} /></div>
              <div className="flex gap-3 pt-2"><button onClick={onClose} className="flex-1 py-2 rounded-lg bg-stone-100 text-stone-600 font-bold text-sm">{UI_LABELS[lang].addModalCancel}</button><button onClick={handleSave} className="flex-1 py-2 rounded-lg bg-rose-400 text-white font-bold text-sm shadow-md">{UI_LABELS[lang].addModalSubmit}</button></div>
            </div>
          </div>
        </div>
      );
    };

    const SplitBillModal = ({ onClose, lang }) => {
      const [partners, setPartners] = useState('');
      const [expenses, setExpenses] = useState([]);
      const [newExpense, setNewExpense] = useState({ payer: '', amount: '', description: '' });
      const [result, setResult] = useState(null);
      const [rate, setRate] = useState(0.023); 

      useEffect(() => {
        const saved = localStorage.getItem('seoul2025_split_bill');
        if (saved) {
          const data = JSON.parse(saved);
          setPartners(data.partners || '');
          setExpenses(data.expenses || []);
        }
      }, []);

      useEffect(() => {
        localStorage.setItem('seoul2025_split_bill', JSON.stringify({ partners, expenses }));
      }, [partners, expenses]);

      const handleAddExpense = () => {
        if (!newExpense.payer || !newExpense.amount) return;
        setExpenses([...expenses, { ...newExpense, id: Date.now() }]);
        setNewExpense({ ...newExpense, amount: '', description: '' });
      };

      const handleCalculate = () => {
        const people = partners.split(/[,ï¼Œ]/).map(p => p.trim()).filter(p => p);
        if (people.length < 2) return;
        const balances = {};
        people.forEach(p => balances[p] = 0);
        let totalSpent = 0;
        expenses.forEach(e => {
          if (balances[e.payer] !== undefined) {
            balances[e.payer] += parseFloat(e.amount);
            totalSpent += parseFloat(e.amount);
          }
        });
        const average = totalSpent / people.length;
        const debts = [];
        const details = people.map(p => ({ name: p, balance: balances[p] - average }));
        let debtors = details.filter(d => d.balance < -0.01).sort((a, b) => a.balance - b.balance);
        let creditors = details.filter(d => d.balance > 0.01).sort((a, b) => b.balance - a.balance);
        let i = 0, j = 0;
        while (i < debtors.length && j < creditors.length) {
          const debtor = debtors[i];
          const creditor = creditors[j];
          const amount = Math.min(Math.abs(debtor.balance), creditor.balance);
          debts.push({ from: debtor.name, to: creditor.name, amount: amount.toFixed(0) });
          debtor.balance += amount;
          creditor.balance -= amount;
          if (Math.abs(debtor.balance) < 0.01) i++;
          if (creditor.balance < 0.01) j++;
        }
        setResult(debts);
      };

      const peopleList = partners.split(/[,ï¼Œ]/).map(p => p.trim()).filter(p => p);
      const totalAmount = expenses.reduce((acc, curr) => acc + (parseFloat(curr.amount) || 0), 0);
      const perPerson = peopleList.length > 0 ? totalAmount / peopleList.length : 0;

      return (
        <div className="fixed inset-0 bg-black/50 backdrop-blur-sm z-[80] flex items-center justify-center p-4" onClick={onClose}>
          <div className="bg-white rounded-2xl shadow-2xl w-full max-w-md overflow-hidden animate-fade-in flex flex-col max-h-[80vh]" onClick={e => e.stopPropagation()}>
            <div className="bg-[#FF7F50] p-4 text-white font-bold text-center flex justify-between items-center">
              <div className="flex items-center gap-2"><Banknote size={20} /> {UI_LABELS[lang].splitBill}</div>
              <button onClick={onClose}><X size={20} /></button>
            </div>
            <div className="p-4 overflow-y-auto flex-1 space-y-4">
              <div className="flex gap-2">
                  <div className="flex-1">
                    <label className="block text-xs text-stone-500 mb-1">æ—…è¡Œä¼™ä¼´ (ç”¨é€—è™Ÿåˆ†éš”)</label>
                    <input type="text" className="w-full border border-stone-200 rounded-lg p-2 text-sm" placeholder="å°æ˜Ž, å°ç¾Ž" value={partners} onChange={e => setPartners(e.target.value)} />
                  </div>
                  <div className="w-24">
                     <label className="block text-xs text-stone-500 mb-1">{UI_LABELS[lang].rate} (KRW->TWD)</label>
                     <input type="number" step="0.001" className="w-full border border-stone-200 rounded-lg p-2 text-sm" value={rate} onChange={e => setRate(e.target.value)} />
                  </div>
              </div>
              
              <div className="bg-stone-50 p-3 rounded-xl flex justify-between items-center text-sm">
                  <div>
                      <div className="text-stone-500 text-xs">{UI_LABELS[lang].total}</div>
                      <div className="font-bold text-lg">â‚©{totalAmount.toLocaleString()} <span className="text-xs font-normal text-stone-400">(â‰ˆNT${(totalAmount * rate).toFixed(0)})</span></div>
                  </div>
                  <div className="text-right">
                      <div className="text-stone-500 text-xs">{UI_LABELS[lang].perPerson}</div>
                      <div className="font-bold text-lg">â‚©{perPerson.toFixed(0)} <span className="text-xs font-normal text-stone-400">(â‰ˆNT${(perPerson * rate).toFixed(0)})</span></div>
                  </div>
              </div>

              {peopleList.length > 0 && (
                <div className="bg-stone-50 p-3 rounded-xl space-y-2 border border-stone-100">
                  <div className="flex gap-2">
                    <select className="flex-1 border rounded-lg p-1.5 text-sm" value={newExpense.payer} onChange={e => setNewExpense({...newExpense, payer: e.target.value})}>
                      <option value="">èª°ä»˜éŒ¢?</option>
                      {peopleList.map(p => <option key={p} value={p}>{p}</option>)}
                    </select>
                    <input type="number" className="w-24 border rounded-lg p-1.5 text-sm" placeholder="é‡‘é¡" value={newExpense.amount} onChange={e => setNewExpense({...newExpense, amount: e.target.value})} />
                  </div>
                  <div className="flex gap-2">
                    <input type="text" className="flex-1 border rounded-lg p-1.5 text-sm" placeholder="é …ç›® (å¯é¸)" value={newExpense.description} onChange={e => setNewExpense({...newExpense, description: e.target.value})} />
                    <button onClick={handleAddExpense} className="bg-[#FF7F50] text-white px-3 rounded-lg text-sm font-bold">+</button>
                  </div>
                </div>
              )}
              <div className="space-y-1 max-h-40 overflow-y-auto">
                {expenses.map((ex, idx) => (
                  <div key={ex.id} className="flex justify-between text-sm p-2 bg-white border rounded-lg items-center">
                    <span><span className="font-bold text-orange-600">{ex.payer}</span> ä»˜äº† {ex.amount} {ex.description && `(${ex.description})`}</span>
                    <button onClick={() => setExpenses(expenses.filter(e => e.id !== ex.id))} className="text-stone-400 hover:text-red-400"><Trash2 size={14}/></button>
                  </div>
                ))}
              </div>
              {result && (
                <div className="bg-orange-50 p-3 rounded-xl border border-orange-100">
                  <h4 className="font-bold text-orange-800 text-sm mb-2">çµç®—çµæžœï¼š</h4>
                  {result.length === 0 ? <p className="text-sm text-orange-600">ç›®å‰æ²’æœ‰äººéœ€è¦ä»˜éŒ¢çµ¦èª°</p> : (
                    <ul className="space-y-1 text-sm text-orange-700">
                      {result.map((r, i) => <li key={i}><span className="font-bold">{r.from}</span> çµ¦ <span className="font-bold">{r.to}</span>: â‚©{r.amount} <span className="text-xs text-stone-400">(NT${(r.amount * rate).toFixed(0)})</span></li>)}
                    </ul>
                  )}
                </div>
              )}
            </div>
            <div className="p-4 border-t">
              <button onClick={handleCalculate} className="w-full bg-[#FF7F50] text-white py-3 rounded-xl font-bold shadow-md hover:bg-orange-500">è¨ˆç®—åˆ†å¸³</button>
            </div>
          </div>
        </div>
      );
    };

    const loadData = (language) => {
        // Upgrade key to v2 to force refresh data structure
        const key = `seoul_trip_2025_v2_${language}`;
        try { 
          const saved = localStorage.getItem(key); 
          if (saved) {
            return JSON.parse(saved); 
          }
        } catch (e) { console.error("Failed to load itinerary", e); }
        return getInitialItinerary(language);
    };

    // Namsan Path Visualization Component
    const NamsanPathVisual = () => (
      <div className="mt-2 p-4 bg-white rounded-xl shadow-sm border border-slate-200">
        <h4 className="text-xs font-bold text-slate-500 mb-2">è·¯ç·šæŒ‡å¼•ï¼šæ˜Žæ´žç«™ âž” å—å±±é€æ˜Žé›»æ¢¯</h4>
        <svg viewBox="0 0 300 120" className="w-full h-auto">
          {/* Roads */}
          <path d="M40,100 L260,100" stroke="#e2e8f0" strokeWidth="20" strokeLinecap="round" />
          <path d="M220,100 L220,30" stroke="#e2e8f0" strokeWidth="20" strokeLinecap="round" />
          
          {/* Path Line */}
          <path d="M50,100 L220,100 L220,50" fill="none" stroke="#fb7185" strokeWidth="3" strokeDasharray="6,4" />
          <path d="M215,55 L220,45 L225,55" fill="none" stroke="#fb7185" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round" />

          {/* Start Point: Myeongdong Stn Exit 4 */}
          <circle cx="50" cy="100" r="6" fill="#3b82f6" />
          <text x="50" y="115" fontSize="10" textAnchor="middle" fill="#475569" fontWeight="bold">æ˜Žæ´žç«™ 4è™Ÿå‡ºå£</text>
          
          {/* Landmark: Intersection */}
          <text x="150" y="95" fontSize="9" textAnchor="middle" fill="#94a3b8">ç›´èµ° (Pacific Hotel)</text>
          <text x="235" y="105" fontSize="9" textAnchor="start" fill="#94a3b8">æœƒè³¢åå­—è·¯å£</text>

          {/* Turn Indicator */}
          <path d="M200,90 Q220,90 220,70" fill="none" stroke="#fb7185" strokeWidth="2" markerEnd="url(#arrow)" />

          {/* End Point: Oreumi */}
          <rect x="205" y="20" width="30" height="30" rx="4" fill="#10b981" />
          <text x="220" y="40" fontSize="16" textAnchor="middle" fill="white">ðŸ›—</text>
          <text x="250" y="38" fontSize="10" textAnchor="start" fill="#10b981" fontWeight="bold">é€æ˜Žé›»æ¢¯</text>
        </svg>
      </div>
    );

    function App() {
      const [lang, setLang] = useState('ZH');
      const [activeDay, setActiveDay] = useState(0);
      const [itinerary, setItinerary] = useState(() => loadData('ZH'));
      const [selectedActivity, setSelectedActivity] = useState(null);
      const [showAddEventModal, setShowAddEventModal] = useState(false);
      const [showSplitBill, setShowSplitBill] = useState(false);
      const [showShoppingList, setShowShoppingList] = useState(false);
      
      const touchStartX = useRef(null);
      const onTouchStart = e => touchStartX.current = e.targetTouches[0].clientX;
      const onTouchEnd = e => { if (!touchStartX.current) return; const diff = touchStartX.current - e.changedTouches[0].clientX; if (diff > 50 && activeDay < itinerary.length - 1) setActiveDay(p => p + 1); if (diff < -50 && activeDay > 0) setActiveDay(p => p - 1); };
      const getInitialActiveDay = () => { const now = new Date(); const year = now.getFullYear(); const month = now.getMonth(); const date = now.getDate(); if (year === 2025 && month === 11 && date >= 18 && date <= 24) return date - 18 + 1; return 0; };

      useEffect(() => { setActiveDay(getInitialActiveDay()); }, []);
      
      // Auto-save effect
      useEffect(() => { 
        if(itinerary && itinerary.length > 0) {
            const key = `seoul_trip_2025_v2_${lang}`; 
            localStorage.setItem(key, JSON.stringify(itinerary)); 
        }
      }, [itinerary, lang]);

      const handleLangChange = (newLang) => {
          setLang(newLang);
          const savedData = loadData(newLang);
          setItinerary(savedData);
      };

      const updateActivity = (d, a, f, v) => { 
        const newItinerary = [...itinerary];
        const newDay = { ...newItinerary[d] };
        const newActivities = [...newDay.activities];
        const newActivity = { ...newActivities[a] };
        newActivity[f] = v;
        newActivities[a] = newActivity;
        newDay.activities = newActivities;
        newItinerary[d] = newDay;
        setItinerary(newItinerary); 
      };
      
      const updateTheme = (d, v) => { 
        const newItinerary = [...itinerary]; 
        newItinerary[d] = { ...newItinerary[d], theme: v };
        setItinerary(newItinerary); 
      };
      
      const handleSaveNewEvent = (time, title) => {
        const newItinerary = [...itinerary];
        const newDay = { ...newItinerary[activeDay] };
        const newActivities = [...newDay.activities];
        newActivities.push({ time: time, title: title, type: 'default', desc: 'é»žæ“Šç·¨è¼¯å…§å®¹', location: title, transport: '' });
        newActivities.sort((a, b) => { const tA = a.time || "99:99"; const tB = b.time || "99:99"; return tA.localeCompare(tB); });
        newDay.activities = newActivities;
        newItinerary[activeDay] = newDay;
        setItinerary(newItinerary);
        setShowAddEventModal(false);
      };

      // Handler for updating custom phrases in a specific activity
      const handleUpdatePhrases = (activityIndex, newCustomPhrases) => {
          const newItinerary = [...itinerary];
          const newDay = { ...newItinerary[activeDay] };
          const newActivities = [...newDay.activities];
          const newActivity = { ...newActivities[activityIndex] };
          
          newActivity.customPhrases = newCustomPhrases;
          
          newActivities[activityIndex] = newActivity;
          newDay.activities = newActivities;
          newItinerary[activeDay] = newDay;
          setItinerary(newItinerary);
      };
      
      const toggleCheck = (dayIdx, actIdx, itemIdx) => {
        const newItinerary = [...itinerary];
        const newDay = { ...newItinerary[dayIdx] };
        const newActivities = [...newDay.activities];
        const newActivity = { ...newActivities[actIdx] };
        const newItems = [...newActivity.items];
        newItems[itemIdx] = { ...newItems[itemIdx], checked: !newItems[itemIdx].checked };
        newActivity.items = newItems;
        newActivities[actIdx] = newActivity;
        newDay.activities = newActivities;
        newItinerary[dayIdx] = newDay;
        setItinerary(newItinerary);
      };

      const updateChecklistItemText = (dayIdx, actIdx, itemIdx, text) => {
        const newItinerary = [...itinerary];
        const newDay = { ...newItinerary[dayIdx] };
        const newActivities = [...newDay.activities];
        const newActivity = { ...newActivities[actIdx] };
        const newItems = [...newActivity.items];
        newItems[itemIdx] = { ...newItems[itemIdx], text: text };
        newActivity.items = newItems;
        newActivities[actIdx] = newActivity;
        newDay.activities = newActivities;
        newItinerary[dayIdx] = newDay;
        setItinerary(newItinerary);
      };

      const addChecklistItem = (dayIdx, actIdx) => {
        const newItinerary = [...itinerary];
        const newDay = { ...newItinerary[dayIdx] };
        const newActivities = [...newDay.activities];
        const newActivity = { ...newActivities[actIdx] };
        const newItems = [...newActivity.items];
        newItems.push({ text: 'é»žæ“Šç·¨è¼¯æ–°é …ç›®', checked: false });
        newActivity.items = newItems;
        newActivities[actIdx] = newActivity;
        newDay.activities = newActivities;
        newItinerary[dayIdx] = newDay;
        setItinerary(newItinerary);
      };

      const deleteChecklistItem = (dayIdx, actIdx, itemIdx) => {
        if (!confirm('ç¢ºå®šåˆªé™¤æ­¤é …ç›®ï¼Ÿ')) return;
        const newItinerary = [...itinerary];
        const newDay = { ...newItinerary[dayIdx] };
        const newActivities = [...newDay.activities];
        const newActivity = { ...newActivities[actIdx] };
        const newItems = [...newActivity.items];
        newItems.splice(itemIdx, 1);
        newActivity.items = newItems;
        newActivities[actIdx] = newActivity;
        newDay.activities = newActivities;
        newItinerary[dayIdx] = newDay;
        setItinerary(newItinerary);
      };

      const currentDay = itinerary[activeDay];

      return (
        <div className="min-h-screen bg-[#fdf8f9] font-sans pb-20 relative">
          <header className="sticky top-0 z-40 bg-[#fdf8f9]/90 backdrop-blur-lg border-b border-rose-100 shadow-sm">
            <div className="max-w-3xl mx-auto px-4 pt-3 pb-0"> 
              <div className="flex flex-row justify-between items-start gap-2 mb-1">
                <div className="flex flex-col items-start gap-1 min-w-0">
                  <h1 className="text-xl md:text-3xl font-bold text-rose-950 tracking-tight truncate w-full">{UI_LABELS[lang].title}</h1>
                  {UI_LABELS[lang].subtitle && <span className="text-xs md:text-sm text-rose-700/70 truncate w-full">{UI_LABELS[lang].subtitle}</span>}
                  <RealTimeDateDisplay />
                </div>
                <div className="flex flex-col items-end gap-2 shrink-0">
                   <TimeWeatherWidget />
                   <div className="flex items-center gap-2">
                     {/* Shopping List Tab Button */}
                     <button onClick={() => setShowShoppingList(true)} className="p-1.5 bg-rose-100 text-rose-600 rounded-full hover:bg-rose-200 transition-colors"><ShoppingBag size={16} /></button>
                     <button onClick={() => setShowSplitBill(true)} className="p-1.5 bg-[#FF7F50] text-white rounded-full hover:bg-[#ff6b35] transition-colors"><Banknote size={16} /></button>
                     <div className="flex bg-rose-100/50 p-1 rounded-full">{Object.keys(LANGUAGES).map(l => <button key={l} onClick={() => handleLangChange(l)} className={`px-2 py-1 rounded-full text-[10px] font-bold transition-all ${lang === l ? 'bg-white text-rose-600 shadow-sm' : 'text-rose-400'}`}>{l}</button>)}</div>
                   </div>
                </div>
              </div>
            </div>
            <div className="max-w-3xl mx-auto px-2 overflow-x-auto no-scrollbar pb-2">
              <div className="flex space-x-2 py-2 min-w-max">
                {/* Day 0: Prep */}
                <button onClick={() => { setActiveDay(0); setShowShoppingList(false); }} className={`flex flex-col items-center min-w-[4rem] py-2 px-2 rounded-2xl border transition-all ${activeDay === 0 && !showShoppingList ? 'bg-rose-400 border-rose-400 text-white shadow-md scale-105' : 'bg-white border-rose-100 text-stone-400'}`}>
                    <span className="text-[10px] font-bold opacity-80">{UI_LABELS[lang].days[0]}</span>
                    <span className="text-sm font-bold mt-0.5">{itinerary[0].date.split(' ')[0]}</span>
                </button>

                {/* Days 1-7 */}
                {itinerary.slice(1).map((day, idx) => (
                  <button key={idx + 1} onClick={() => { setActiveDay(idx + 1); setShowShoppingList(false); }} className={`flex flex-col items-center min-w-[4rem] py-2 px-2 rounded-2xl border transition-all ${activeDay === (idx + 1) && !showShoppingList ? 'bg-rose-400 border-rose-400 text-white shadow-md scale-105' : 'bg-white border-rose-100 text-stone-400'}`}>
                    <span className="text-[10px] font-bold opacity-80">{UI_LABELS[lang].days[idx + 1]}</span>
                    <span className="text-sm font-bold mt-0.5">{day.date.split(' ')[0]}</span>
                  </button>
                ))}
              </div>
            </div>
          </header>
          
          <main className="max-w-3xl mx-auto px-4 py-4 pb-20 relative min-h-[60vh]" onTouchStart={onTouchStart} onTouchEnd={onTouchEnd}>
            {showShoppingList ? (
                <div className="animate-fade-in h-full">
                    <ShoppingListContent lang={lang} />
                </div>
            ) : (
            <div key={activeDay} className="animate-fade-in">
              <div className="mb-6 pl-2 border-l-4 border-rose-300 flex justify-between items-center">
                <div>
                  <div className="text-stone-400 text-sm font-medium mb-0.5">{currentDay.date}</div>
                  <h2 className="text-xl font-bold text-stone-800"><EditableText text={currentDay.theme} onSave={(v) => updateTheme(activeDay, v)} /></h2>
                </div>
                <div className="flex gap-2">
                  {activeDay !== 0 && activeDay !== 1 && activeDay !== 7 && (
                    <button onClick={() => setShowAddEventModal(true)} className="flex items-center gap-1 text-xs font-bold text-white bg-rose-400 px-3 py-1.5 rounded-full shadow-sm hover:bg-rose-500 transition-colors shrink-0"><Plus size={14} /><span>{UI_LABELS[lang].addEvent}</span></button>
                  )}
                </div>
              </div>
              <div className="relative space-y-6 pl-4 border-l-2 border-rose-100 ml-3">
                {currentDay.activities.map((item, i) => (
                  <div key={i} className="relative group">
                    <div className={`bg-white rounded-2xl p-4 shadow-sm border hover:shadow-md transition-shadow ${item.type.includes('warning') ? 'border-amber-200 bg-amber-50/30' : (item.type === 'checklist' ? 'border-emerald-100' : (item.type === 'ses' ? 'border-blue-200 bg-blue-50/30' : 'border-stone-100'))}`}>
                      {item.type === 'checklist' || item.type.includes('warning') || item.type === 'doc' || item.type === 'ses' ? (
                        <div>
                           <div className="flex items-center gap-2 mb-2">
                              <h3 className={`font-bold text-lg ${item.type.includes('warning') ? 'text-amber-700' : (item.type === 'ses' ? 'text-blue-800' : 'text-stone-800')}`}>{item.title}</h3>
                           </div>
                           <p className="text-sm text-stone-500 mb-3">{item.desc}</p>
                           <ul className="space-y-2">
                             {item.items && item.items.map((subItem, subIdx) => (
                               <li key={subIdx} className="flex items-start gap-2 text-sm text-stone-700 group/item">
                                  {item.type !== 'ses' && (
                                    <input 
                                      type="checkbox" 
                                      checked={subItem.checked || false}
                                      onChange={() => toggleCheck(activeDay, i, subIdx)}
                                      className={`mt-1 w-4 h-4 rounded border-gray-300 focus:ring-rose-400 cursor-pointer ${item.type.includes('warning') ? 'accent-amber-500' : 'accent-emerald-500'}`} 
                                    />
                                  )}
                                  <span className={`flex-1 break-words ${item.type === 'ses' ? 'text-blue-700 font-medium' : (subItem.checked ? 'line-through text-stone-400' : '')}`}>
                                    {item.type === 'ses' ? subItem.text : (
                                      <EditableText 
                                        text={subItem.text} 
                                        onSave={(val) => updateChecklistItemText(activeDay, i, subIdx, val)} 
                                        className="w-full"
                                      />
                                    )}
                                  </span>
                                  {item.type !== 'ses' && (
                                    <button 
                                      onClick={() => deleteChecklistItem(activeDay, i, subIdx)}
                                      className="opacity-0 group-hover/item:opacity-100 text-stone-400 hover:text-red-400 transition-opacity"
                                    >
                                      <Trash2 size={14} />
                                    </button>
                                  )}
                               </li>
                             ))}
                           </ul>
                           {item.type !== 'ses' && (
                             <button 
                               onClick={() => addChecklistItem(activeDay, i)}
                               className="mt-3 text-xs flex items-center gap-1 text-stone-400 hover:text-rose-500 transition-colors"
                             >
                               <Plus size={12} /> {UI_LABELS[lang].addItem}
                             </button>
                           )}
                        </div>
                      ) : (
                        <div>
                          <div className="flex justify-between items-center mb-2 pb-2 border-b border-stone-50">
                            <div className="flex items-center gap-2 overflow-hidden">
                               <div className="bg-rose-100 text-rose-500 rounded-full p-1 shrink-0">
                                 <IconType type={item.type} className="w-3 h-3" />
                               </div>
                               <span className="font-mono text-rose-500 font-bold bg-rose-50 px-1.5 rounded text-sm shrink-0"><EditableText text={item.time} onSave={(v) => updateActivity(activeDay, i, 'time', v)} /></span>
                               <h3 className="font-bold text-stone-800 truncate"><EditableText text={item.title} onSave={(v) => updateActivity(activeDay, i, 'title', v)} /></h3>
                            </div>
                            <ActivityWeather day={activeDay} index={i} location={item.location} />
                          </div>
                          <div className="text-stone-600 text-sm mb-3 leading-relaxed"><EditableText multiline text={item.desc} onSave={(v) => updateActivity(activeDay, i, 'desc', v)} /></div>
                          
                          {/* Visual Path for Namsan Oreumi (Only show if visual property exists) */}
                          {item.visual === 'namsan_path' && <NamsanPathVisual />}
                          
                          {item.link && (
                            <a 
                              href={item.link.url} 
                              target="_blank" 
                              rel="noopener noreferrer"
                              className="flex items-center gap-1 text-indigo-500 hover:text-indigo-600 transition-colors shrink-0 text-xs mt-1 mb-2 w-fit"
                              onClick={(e) => e.stopPropagation()}
                            >
                              <span className="text-base">ðŸŒ</span>
                              <span className="border-b border-transparent hover:border-indigo-500 font-medium">{item.link.text}</span>
                            </a>
                          )}

                          <button 
                            onClick={() => setSelectedActivity({ ...item, index: i })} 
                            className="flex items-center gap-1 text-[10px] font-bold text-rose-500 bg-rose-50 px-2 py-1 rounded hover:bg-rose-100 transition-colors w-fit mb-2"
                          >
                            <Sparkles size={10} />{UI_LABELS[lang].genPhrases}
                          </button>
                          {(item.location || item.transport || item.duration) && (
                            <div className="mt-2 flex flex-wrap items-center gap-x-2 gap-y-1 text-xs text-stone-500">
                              {item.location && (
                                <a 
                                  href={`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(item.location)}`} 
                                  target="_blank" 
                                  rel="noopener noreferrer"
                                  className="flex items-center gap-1 text-rose-400 hover:text-rose-600 transition-colors group/map shrink-0"
                                  onClick={(e) => e.stopPropagation()}
                                >
                                  <MapPin size={11} className="group-hover/map:scale-110 transition-transform" />
                                  <span className="border-b border-transparent group-hover/map:border-rose-400">{item.location}</span>
                                </a>
                              )}
                              {item.transport && <TransportDisplay text={item.transport} />}
                            </div>
                          )}
                        </div>
                      )}

                    </div>
                  </div>
                ))}
              </div>
            </div>
            )}
          </main>

          <AIChatWidget itinerary={itinerary} lang={lang} />
          {selectedActivity && (
            <MagicPhraseModal 
                activity={selectedActivity} 
                lang={lang} 
                onClose={() => setSelectedActivity(null)} 
                onSavePhrases={(newPhrases) => handleUpdatePhrases(selectedActivity.index, newPhrases)}
            />
          )}
          {showAddEventModal && <AddEventModal onClose={() => setShowAddEventModal(false)} onSave={handleSaveNewEvent} lang={lang} />}
          {showSplitBill && <SplitBillModal onClose={() => setShowSplitBill(false)} lang={lang} />}
        </div>
      );
    }

    const root = createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
